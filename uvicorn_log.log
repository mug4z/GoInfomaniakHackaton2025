[2025-08-29T19:10:56.370     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T19:10:56.370     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T19:10:56.371     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T19:10:56.371     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T19:10:56.372     INFO function=startup      L0080 file=basereload.p] Started reloader process [13904] using WatchFiles
[2025-08-29T19:10:56.372     INFO function=startup      L0080 file=basereload.p] Started reloader process [13904] using WatchFiles
[2025-08-29T19:10:57.198     INFO function=_log_changes L0308 file=main.py     ] 7 changes detected
[2025-08-29T19:10:58.160     INFO function=_log_changes L0308 file=main.py     ] 8 changes detected
[2025-08-29T19:10:59.228     INFO function=_log_changes L0308 file=main.py     ] 20 changes detected
[2025-08-29T19:10:59.580     INFO function=_log_changes L0308 file=main.py     ] 25 changes detected
[2025-08-29T19:11:01.966     INFO function=_log_changes L0308 file=main.py     ] 4 changes detected
[2025-08-29T19:11:03.948     INFO function=_serve       L0084 file=server.py   ] Started server process [7188]
[2025-08-29T19:11:03.948     INFO function=_serve       L0084 file=server.py   ] Started server process [7188]
[2025-08-29T19:11:03.949     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T19:11:03.949     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T19:11:03.953     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T19:11:03.953     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T19:11:04.056     INFO function=_log_changes L0308 file=main.py     ] 4 changes detected
[2025-08-29T19:12:06.528     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65148 - "GET / HTTP/1.1" 404
[2025-08-29T19:12:06.528     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65148 - "GET / HTTP/1.1" 404
[2025-08-29T19:12:06.613     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65148 - "GET /favicon.ico HTTP/1.1" 404
[2025-08-29T19:12:06.613     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65148 - "GET /favicon.ico HTTP/1.1" 404
[2025-08-29T19:12:30.761     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57422 - "GET /docs HTTP/1.1" 200
[2025-08-29T19:12:30.761     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57422 - "GET /docs HTTP/1.1" 200
[2025-08-29T19:12:31.923     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57422 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T19:12:31.923     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57422 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T19:21:07.670     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55934 - "GET /ping HTTP/1.1" 200
[2025-08-29T19:21:07.670     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55934 - "GET /ping HTTP/1.1" 200
[2025-08-29T19:31:53.615     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50169 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:31:53.615     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50169 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:34:03.921     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50171 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:34:03.921     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50171 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:34:28.027     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T19:34:28.718     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T19:34:29.596     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T19:34:29.598     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51135 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:34:29.598     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51135 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:34:29.599    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:34:29.599    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:35:20.196     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T19:35:20.916     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T19:35:21.430     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T19:35:21.431     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60614 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:35:21.431     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60614 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:35:21.432    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:35:21.432    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:35:46.354     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60618 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:35:46.354     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60618 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:36:12.383     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60621 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:36:12.383     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60621 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:36:29.931     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60624 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:36:29.931     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60624 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:37:32.668     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60631 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:37:32.668     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60631 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:37:48.776     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T19:37:51.628     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3?prefered_format=plain "HTTP/1.1 500 Internal Server Error"
[2025-08-29T19:37:51.629    ERROR function=async_get_ma L0241 file=mail.py     ] Failed to get email: 500 - {"result":"error","error":{"code":"mail__imap_authentication_failed","description":"Mail  imap authentication failed"}}
[2025-08-29T19:37:51.630    ERROR function=fetch_mail   L0044 file=mail_utils.p] Failed to fetch email for msg_id 3: Failed to get email: 500
[2025-08-29T19:37:51.943     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T19:37:51.945     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60634 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:37:51.945     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60634 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T19:37:51.946    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:37:51.946    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T19:39:45.774     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51162 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T19:39:45.774     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51162 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T20:17:59.872     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53266 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T20:17:59.872     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53266 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 401
[2025-08-29T20:26:48.433     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T20:26:49.116     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:26:49.639     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T20:26:49.641     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54789 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T20:26:49.641     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54789 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T20:26:49.642    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:26:49.642    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:49:24.274     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T20:49:24.955     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:49:25.516     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T20:49:25.519     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49765 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T20:49:25.519     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49765 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/thread/3/event_suggestion HTTP/1.1" 500
[2025-08-29T20:49:25.520    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:49:25.520    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:58:12.301     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T20:58:13.281     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:58:13.284     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:58:13.704     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T20:58:13.705     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55252 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T20:58:13.705     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55252 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T20:58:13.706    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:58:13.706    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:59:32.771     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55258 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T20:59:32.771     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55258 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T20:59:45.092     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T20:59:46.026     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:59:46.028     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T20:59:46.397     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T20:59:46.399     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55259 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T20:59:46.399     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55259 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T20:59:46.399    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T20:59:46.399    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:09:41.710     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:09:42.703     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:09:42.718     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:09:43.120     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:09:43.121     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60411 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:09:43.121     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60411 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:09:43.122    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:09:43.122    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:11:11.971     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60421 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:11:11.971     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60421 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:13:48.175     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:13:49.382     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:13:49.392     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:13:49.835     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:13:49.837     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51864 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:13:49.837     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51864 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:13:49.838    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:13:49.838    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:17:51.361     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55780 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:17:51.361     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55780 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:21:45.441     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57696 - "GET /ping HTTP/1.1" 200
[2025-08-29T21:21:45.441     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57696 - "GET /ping HTTP/1.1" 200
[2025-08-29T21:24:08.874     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:24:09.832     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:24:09.835     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:24:10.257     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:24:10.258     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59336 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:24:10.258     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59336 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:24:10.259    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:24:10.259    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:26:16.419     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:26:17.537     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:26:17.558     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:26:17.912     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:26:17.913     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60169 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:26:17.913     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60169 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:26:17.914    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:26:17.914    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:27:46.295     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:27:48.785     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 500 Internal Server Error"
[2025-08-29T21:27:48.787    ERROR function=async_get_ma L0241 file=mail.py     ] Failed to get email: 500 - {"result":"error","error":{"code":"mail__imap_authentication_failed","description":"Mail  imap authentication failed"}}
[2025-08-29T21:27:48.788     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 500 Internal Server Error"
[2025-08-29T21:27:48.789    ERROR function=fetch_mail   L0044 file=mail_utils.p] Failed to fetch email for msg_id 5: Failed to get email: 500
[2025-08-29T21:27:48.790    ERROR function=async_get_ma L0241 file=mail.py     ] Failed to get email: 500 - {"result":"error","error":{"code":"mail__imap_authentication_failed","description":"Mail  imap authentication failed"}}
[2025-08-29T21:27:48.791    ERROR function=fetch_mail   L0044 file=mail_utils.p] Failed to fetch email for msg_id 1: Failed to get email: 500
[2025-08-29T21:27:49.233     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:27:49.236     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59905 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:27:49.236     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59905 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:27:49.237    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:27:49.237    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:30:27.198     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62433 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:30:27.198     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62433 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:46:36.526     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51966 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:46:36.526     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51966 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:47:03.182     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64281 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:47:03.182     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64281 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 401
[2025-08-29T21:47:24.291     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T21:47:25.419     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:47:25.422     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T21:47:25.896     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T21:47:25.898     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55495 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:47:25.898     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55495 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T21:47:25.898    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T21:47:25.898    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T22:00:29.190     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T22:00:30.171     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T22:00:30.192     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T22:00:30.637     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 403 Forbidden"
[2025-08-29T22:00:30.638     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63420 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T22:00:30.638     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63420 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 500
[2025-08-29T22:00:30.639    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T22:00:30.639    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\mail.py", line 98, in event_suggestion
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.PermissionDeniedError: Error code: 403 - {'result': 'error', 'error': {'code': 'invalid_scope_token', 'description': 'missing_ai_tools_scope'}}
[2025-08-29T22:01:50.129     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60262 - "GET /docs HTTP/1.1" 200
[2025-08-29T22:01:50.129     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60262 - "GET /docs HTTP/1.1" 200
[2025-08-29T22:01:50.326     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60262 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T22:01:50.326     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60262 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T22:02:55.729     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:02:55.729     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:02:55.841     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:02:55.841     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:02:55.864     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:02:55.864     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:02:55.874     INFO function=_serve       L0094 file=server.py   ] Finished server process [7188]
[2025-08-29T22:02:55.874     INFO function=_serve       L0094 file=server.py   ] Finished server process [7188]
[2025-08-29T22:02:56.729     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [13904]
[2025-08-29T22:02:56.729     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [13904]
[2025-08-29T22:03:43.335     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T22:03:43.335     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T22:03:43.336     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T22:03:43.336     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T22:03:43.337     INFO function=startup      L0080 file=basereload.p] Started reloader process [4092] using WatchFiles
[2025-08-29T22:03:43.337     INFO function=startup      L0080 file=basereload.p] Started reloader process [4092] using WatchFiles
[2025-08-29T22:03:47.501     INFO function=_serve       L0084 file=server.py   ] Started server process [14668]
[2025-08-29T22:03:47.501     INFO function=_serve       L0084 file=server.py   ] Started server process [14668]
[2025-08-29T22:03:47.502     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T22:03:47.502     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T22:03:47.503     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T22:03:47.503     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T22:03:50.555     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64276 - "GET /docs HTTP/1.1" 200
[2025-08-29T22:03:50.555     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64276 - "GET /docs HTTP/1.1" 200
[2025-08-29T22:03:50.642     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64276 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T22:03:50.642     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64276 - "GET /openapi.json HTTP/1.1" 200
[2025-08-29T22:03:57.378     INFO function=event_sugges L0071 file=mail.py     ] Request for mailbox uuid: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-29T22:03:58.369     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/message/1?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T22:03:58.372     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5?prefered_format=plain "HTTP/1.1 200 OK"
[2025-08-29T22:04:01.904     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-29T22:04:04.985     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-29T22:04:04.988     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54681 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 200
[2025-08-29T22:04:04.988     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54681 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJwLTs0rAQADzwGb/thread/1/event_suggestion HTTP/1.1" 200
[2025-08-29T22:17:05.592     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:17:05.592     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:17:05.714     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:17:05.714     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:17:05.718     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:17:05.718     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:17:05.720     INFO function=_serve       L0094 file=server.py   ] Finished server process [14668]
[2025-08-29T22:17:05.720     INFO function=_serve       L0094 file=server.py   ] Finished server process [14668]
[2025-08-29T22:17:06.330     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [4092]
[2025-08-29T22:17:06.330     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [4092]
[2025-08-29T22:19:56.867     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T22:19:56.867     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-29T22:19:56.868     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T22:19:56.868     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-29T22:19:56.869     INFO function=startup      L0080 file=basereload.p] Started reloader process [3916] using WatchFiles
[2025-08-29T22:19:56.869     INFO function=startup      L0080 file=basereload.p] Started reloader process [3916] using WatchFiles
[2025-08-29T22:20:00.927     INFO function=_serve       L0084 file=server.py   ] Started server process [11296]
[2025-08-29T22:20:00.927     INFO function=_serve       L0084 file=server.py   ] Started server process [11296]
[2025-08-29T22:20:00.928     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T22:20:00.928     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-29T22:20:00.928     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T22:20:00.928     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-29T22:33:25.707     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:33:25.707     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-29T22:33:25.810     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:33:25.810     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-29T22:33:25.811     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:33:25.811     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-29T22:33:25.812     INFO function=_serve       L0094 file=server.py   ] Finished server process [11296]
[2025-08-29T22:33:25.812     INFO function=_serve       L0094 file=server.py   ] Finished server process [11296]
[2025-08-29T22:33:26.154     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [3916]
[2025-08-29T22:33:26.154     INFO function=shutdown     L0116 file=basereload.p] Stopping reloader process [3916]
[2025-08-30T16:04:52.507     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-30T16:04:52.507     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-30T16:04:52.509     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-30T16:04:52.509     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-30T16:04:52.509     INFO function=startup      L0080 file=basereload.p] Started reloader process [552] using WatchFiles
[2025-08-30T16:04:52.509     INFO function=startup      L0080 file=basereload.p] Started reloader process [552] using WatchFiles
[2025-08-30T16:04:53.399     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:04:55.173     INFO function=_log_changes L0308 file=main.py     ] 15 changes detected
[2025-08-30T16:05:36.426     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:05:36.427  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\main.py'. Reloading...
[2025-08-30T16:05:36.427  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\main.py'. Reloading...
[2025-08-30T16:05:37.339     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:05:40.422     INFO function=_log_changes L0308 file=main.py     ] 4 changes detected
[2025-08-30T16:10:48.420     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:10:48.421  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:10:48.421  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:10:52.301     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:11:34.969     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:11:34.970  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:11:34.970  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:11:38.750     INFO function=_serve       L0084 file=server.py   ] Started server process [12492]
[2025-08-30T16:11:38.750     INFO function=_serve       L0084 file=server.py   ] Started server process [12492]
[2025-08-30T16:11:38.751     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:11:38.751     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:11:38.751     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:11:38.751     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:11:38.802     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:11:59.055     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:11:59.056  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:11:59.056  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:11:59.161     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:11:59.161     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:11:59.263     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:11:59.263     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:11:59.264     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:11:59.264     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:11:59.265     INFO function=_serve       L0094 file=server.py   ] Finished server process [12492]
[2025-08-30T16:11:59.265     INFO function=_serve       L0094 file=server.py   ] Finished server process [12492]
[2025-08-30T16:12:03.504     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:15:40.718     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:15:40.719  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:15:40.719  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:15:44.647     INFO function=_serve       L0084 file=server.py   ] Started server process [4344]
[2025-08-30T16:15:44.647     INFO function=_serve       L0084 file=server.py   ] Started server process [4344]
[2025-08-30T16:15:44.648     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:15:44.648     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:15:44.649     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:15:44.649     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:15:44.702     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:19:12.536     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:19:12.537  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:19:12.537  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:19:12.543     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:19:12.543     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:19:12.651     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:19:12.651     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:19:12.652     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:19:12.652     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:19:12.653     INFO function=_serve       L0094 file=server.py   ] Finished server process [4344]
[2025-08-30T16:19:12.653     INFO function=_serve       L0094 file=server.py   ] Finished server process [4344]
[2025-08-30T16:19:17.076     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:22:07.375     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:22:11.479     INFO function=_log_changes L0308 file=main.py     ] 2 changes detected
[2025-08-30T16:22:24.590     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:22:24.591  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:22:24.591  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:22:26.418     INFO function=_log_changes L0308 file=main.py     ] 7 changes detected
[2025-08-30T16:22:28.733     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:24:32.730     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:26:51.717     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:26:51.718  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:26:51.718  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:26:53.484     INFO function=_log_changes L0308 file=main.py     ] 4 changes detected
[2025-08-30T16:26:55.623     INFO function=_serve       L0084 file=server.py   ] Started server process [14356]
[2025-08-30T16:26:55.623     INFO function=_serve       L0084 file=server.py   ] Started server process [14356]
[2025-08-30T16:26:55.624     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:26:55.624     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:26:55.625     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:26:55.625     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:26:55.706     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:36:07.991     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63354 - "GET /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 405
[2025-08-30T16:36:07.991     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63354 - "GET /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 405
[2025-08-30T16:36:15.309     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63355 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 422
[2025-08-30T16:36:15.309     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63355 - "POST /mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 422
[2025-08-30T16:37:11.238     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:37:11.239  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:37:11.239  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:37:11.321     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:37:11.321     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:37:11.436     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:37:11.436     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:37:11.437     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:37:11.437     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:37:11.437     INFO function=_serve       L0094 file=server.py   ] Finished server process [14356]
[2025-08-30T16:37:11.437     INFO function=_serve       L0094 file=server.py   ] Finished server process [14356]
[2025-08-30T16:37:16.537     INFO function=_serve       L0084 file=server.py   ] Started server process [11056]
[2025-08-30T16:37:16.537     INFO function=_serve       L0084 file=server.py   ] Started server process [11056]
[2025-08-30T16:37:16.538     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:37:16.538     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:37:16.539     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:37:16.539     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:37:16.583     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:37:29.370     INFO function=send         L0476 file=httptools_im] 127.0.0.1:56106 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 422
[2025-08-30T16:37:29.370     INFO function=send         L0476 file=httptools_im] 127.0.0.1:56106 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 422
[2025-08-30T16:43:59.094     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:43:59.095  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:43:59.095  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:43:59.133     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:43:59.133     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:43:59.244     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:43:59.244     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:43:59.246     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:43:59.246     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:43:59.246     INFO function=_serve       L0094 file=server.py   ] Finished server process [11056]
[2025-08-30T16:43:59.246     INFO function=_serve       L0094 file=server.py   ] Finished server process [11056]
[2025-08-30T16:44:04.257     INFO function=_serve       L0084 file=server.py   ] Started server process [9836]
[2025-08-30T16:44:04.257     INFO function=_serve       L0084 file=server.py   ] Started server process [9836]
[2025-08-30T16:44:04.258     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:44:04.258     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:44:04.259     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:44:04.259     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:44:04.342     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:44:10.452     INFO function=summary_emai L0069 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T16:44:10.452     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59823 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:44:10.452     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59823 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:44:10.453    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 70, in summary_emails
    mails = await list_mails(ik_api, mailbox_id, folder_id, from_date=datetime.datetime.now() - datetime.timedelta(days=1), to_date=datetime.datetime.now())
                                                                      ^^^^^^^^
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'?
[2025-08-30T16:44:10.453    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 70, in summary_emails
    mails = await list_mails(ik_api, mailbox_id, folder_id, from_date=datetime.datetime.now() - datetime.timedelta(days=1), to_date=datetime.datetime.now())
                                                                      ^^^^^^^^
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'?
[2025-08-30T16:45:46.677     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:45:46.678  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:45:46.678  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:45:46.746     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:45:46.746     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:45:46.847     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:45:46.847     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:45:46.848     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:45:46.848     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:45:46.848     INFO function=_serve       L0094 file=server.py   ] Finished server process [9836]
[2025-08-30T16:45:46.848     INFO function=_serve       L0094 file=server.py   ] Finished server process [9836]
[2025-08-30T16:45:51.141     INFO function=_serve       L0084 file=server.py   ] Started server process [15084]
[2025-08-30T16:45:51.141     INFO function=_serve       L0084 file=server.py   ] Started server process [15084]
[2025-08-30T16:45:51.142     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:45:51.142     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:45:51.143     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:45:51.143     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:45:51.221     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:45:52.200     INFO function=summary_emai L0070 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T16:45:52.914     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+16%3A45%3A52&stodate=2025-08-30+16%3A45%3A52 "HTTP/1.1 200 OK"
[2025-08-30T16:45:52.921     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52601 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:45:52.921     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52601 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:45:52.922    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 76, in summary_emails
    for mail in mails.data.threads.messages:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'messages'
[2025-08-30T16:45:52.922    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 76, in summary_emails
    for mail in mails.data.threads.messages:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'messages'
[2025-08-30T16:46:26.487     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:46:26.488  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\request\mail.py'. Reloading...
[2025-08-30T16:46:26.488  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\request\mail.py'. Reloading...
[2025-08-30T16:46:26.533     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:46:26.533     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:46:26.647     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:46:26.647     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:46:26.648     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:46:26.648     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:46:26.649     INFO function=_serve       L0094 file=server.py   ] Finished server process [15084]
[2025-08-30T16:46:26.649     INFO function=_serve       L0094 file=server.py   ] Finished server process [15084]
[2025-08-30T16:46:28.737     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:46:42.461     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:46:42.462  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:46:42.462  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:46:46.377     INFO function=_serve       L0084 file=server.py   ] Started server process [4792]
[2025-08-30T16:46:46.377     INFO function=_serve       L0084 file=server.py   ] Started server process [4792]
[2025-08-30T16:46:46.378     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:46:46.378     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:46:46.379     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:46:46.379     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:46:46.454     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:47:21.176     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:47:21.177  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:47:21.177  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:47:21.195     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:47:21.195     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:47:21.297     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:47:21.297     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:47:21.298     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:47:21.298     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:47:21.299     INFO function=_serve       L0094 file=server.py   ] Finished server process [4792]
[2025-08-30T16:47:21.299     INFO function=_serve       L0094 file=server.py   ] Finished server process [4792]
[2025-08-30T16:47:25.690     INFO function=_serve       L0084 file=server.py   ] Started server process [7900]
[2025-08-30T16:47:25.690     INFO function=_serve       L0084 file=server.py   ] Started server process [7900]
[2025-08-30T16:47:25.691     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:47:25.691     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:47:25.692     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:47:25.692     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:47:25.772     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:49:07.911     INFO function=summary_emai L0069 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T16:49:08.616     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+16%3A49%3A07&stodate=2025-08-30+16%3A49%3A07 "HTTP/1.1 200 OK"
[2025-08-30T16:49:08.622     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64121 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:49:08.622     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64121 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:49:08.622    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 82, in summary_emails
    body = mail.body.value
           ^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Thread' object has no attribute 'body'
[2025-08-30T16:49:08.622    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 82, in summary_emails
    body = mail.body.value
           ^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Thread' object has no attribute 'body'
[2025-08-30T16:53:14.253     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T16:53:14.254  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:53:14.254  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T16:53:14.306     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:53:14.306     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T16:53:14.407     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:53:14.407     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T16:53:14.408     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:53:14.408     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T16:53:14.408     INFO function=_serve       L0094 file=server.py   ] Finished server process [7900]
[2025-08-30T16:53:14.408     INFO function=_serve       L0094 file=server.py   ] Finished server process [7900]
[2025-08-30T16:53:18.806     INFO function=_serve       L0084 file=server.py   ] Started server process [14192]
[2025-08-30T16:53:18.806     INFO function=_serve       L0084 file=server.py   ] Started server process [14192]
[2025-08-30T16:53:18.807     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:53:18.807     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T16:53:18.808     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:53:18.808     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T16:53:18.865     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T16:53:22.287     INFO function=summary_emai L0069 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T16:53:22.992     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+16%3A53%3A22&stodate=2025-08-30+16%3A53%3A22 "HTTP/1.1 200 OK"
[2025-08-30T16:53:22.995     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60163 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:53:22.995     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60163 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T16:53:22.995    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 82, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T16:53:22.995    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 82, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T17:01:39.651     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:01:39.652  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:01:39.652  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:01:39.713     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:01:39.713     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:01:39.828     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:01:39.828     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:01:39.828     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:01:39.828     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:01:39.829     INFO function=_serve       L0094 file=server.py   ] Finished server process [14192]
[2025-08-30T17:01:39.829     INFO function=_serve       L0094 file=server.py   ] Finished server process [14192]
[2025-08-30T17:01:45.421     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:03:26.394     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:03:26.395  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:03:26.395  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:03:30.689     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:03:50.229     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:03:50.230  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:03:50.230  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:03:54.112     INFO function=_serve       L0084 file=server.py   ] Started server process [13392]
[2025-08-30T17:03:54.112     INFO function=_serve       L0084 file=server.py   ] Started server process [13392]
[2025-08-30T17:03:54.113     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:03:54.113     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:03:54.114     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:03:54.114     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:03:54.165     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:04:00.288     INFO function=summary_emai L0072 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:04:01.019     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A04%3A00&stodate=2025-08-30+17%3A04%3A00 "HTTP/1.1 200 OK"
[2025-08-30T17:04:01.022     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59804 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:04:01.022     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59804 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:04:01.023    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 79, in summary_emails
    for message in thread.messages:
                   ^^^^^^^^^^^^^^^
AttributeError: 'tuple' object has no attribute 'messages'
[2025-08-30T17:04:01.023    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 79, in summary_emails
    for message in thread.messages:
                   ^^^^^^^^^^^^^^^
AttributeError: 'tuple' object has no attribute 'messages'
[2025-08-30T17:06:19.711     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:06:19.712  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:06:19.712  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:06:19.768     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:06:19.768     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:06:19.884     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:06:19.884     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:06:19.885     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:06:19.885     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:06:19.886     INFO function=_serve       L0094 file=server.py   ] Finished server process [13392]
[2025-08-30T17:06:19.886     INFO function=_serve       L0094 file=server.py   ] Finished server process [13392]
[2025-08-30T17:06:24.417     INFO function=_serve       L0084 file=server.py   ] Started server process [12468]
[2025-08-30T17:06:24.417     INFO function=_serve       L0084 file=server.py   ] Started server process [12468]
[2025-08-30T17:06:24.418     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:06:24.418     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:06:24.419     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:06:24.419     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:06:24.492     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:06:27.656     INFO function=summary_emai L0072 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:06:28.401     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A06%3A27&stodate=2025-08-30+17%3A06%3A27 "HTTP/1.1 200 OK"
[2025-08-30T17:06:28.404     INFO function=summary_emai L0078 file=daily.py    ] Type de mails.data: <class 'common.models.response.mail.ListEmailsResponseData'>
[2025-08-30T17:06:28.408     INFO function=summary_emai L0079 file=daily.py    ] Contenu de mails.data: messages_count=5 threads=[Thread(uid='eJwryShKTUyxNndI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2swLcQ--', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')], cc=[], bcc=[], date=datetime.datetime(2025, 8, 30, 12, 0, 37, tzinfo=TzInfo(+02:00)), subject='Exploitez la puissance de kDrive', messages=[ThreadMessage(uid='7@eJzz9HPyjwAABGYBgQ--', msg_id='6RvfEtJ80MWfH4nXVTQuNwuju5xJWwVU6SAuakyfmqw@api-notify-worker-automail-5578565c5b-wjs9x', date=datetime.datetime(2025, 8, 30, 12, 0, 37, tzinfo=TzInfo(+02:00)), subject='Exploitez la puissance de kDrive', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')], cc=[], bcc=[], priority='normal', resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/7', download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/7/download', has_attachments=False, seen=True, forwarded=False, answered=False, flagged=False, preview='Exploitez la puissance de kDrive Infomaniak \xa0 [IMG:1797827-hackaton.ch]Infomaniak ** Drive ** \xa0 *Exploitez la puissance de kDrive* Bonjour Loc Gosselke, Voici des ressources qui vous aideront  plein', body=None)]), Thread(uid='eJwryShKTUyxNnNI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2rALcA--', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], date=datetime.datetime(2025, 8, 30, 8, 12, 40, tzinfo=TzInfo(+02:00)), subject='Vous avez 1 message non lu dans hackaton.ch', messages=[ThreadMessage(uid='6@eJzz9HPyjwAABGYBgQ--', msg_id='381460b03415015d38883a59363cf47e@infomaniak.com', date=datetime.datetime(2025, 8, 30, 8, 12, 40, tzinfo=TzInfo(+02:00)), subject='Vous avez 1 message non lu dans hackaton.ch', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], priority='normal', resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/6', download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/6/download', has_attachments=False, seen=True, forwarded=False, answered=False, flagged=False, preview='Infomaniak kChat Infomaniak \xa0 \xa0 Vous avez 1 message non lu dans hackaton.ch Ouvrir kChat 1 message dans vos conversations directes sylvie.forster vendredi 29 aot 2025 17:13 1 nouveau message Mettez ', body=None)]), Thread(uid='eJwryShKTUyxNnVI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2pQLbw--', from_=[EmailAddress(email='sylvie.forster@hackaton.ch', name='')], to=[EmailAddress(email='mug4z@protonmail.com', name='Timothe Frily'), EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], date=datetime.datetime(2025, 8, 29, 18, 5, 41, tzinfo=TzInfo(+02:00)), subject='Mon anni', messages=[ThreadMessage(uid='5@eJzz9HPyjwAABGYBgQ--', msg_id='257be70c-b118-400e-9f2d-28c9558a921d@mail.infomaniak.com', date=datetime.datetime(2025, 8, 29, 18, 5, 41, tzinfo=TzInfo(+02:00)), subject='Mon anni', from_=[EmailAddress(email='sylvie.forster@hackaton.ch', name='')], to=[EmailAddress(email='mug4z@protonmail.com', name='Timothe Frily'), EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], priority='normal', resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5', download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5/download', has_attachments=False, seen=True, forwarded=False, answered=True, flagged=False, preview='Hello! Peux-tu venir  mon anni le 13 septembre  8h30? Nous allons pcher le silure. A bientot Sylvie', body=None)]), Thread(uid='eJwryShKTUyxNnFI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2ngLbg--', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')], cc=[], bcc=[], date=datetime.datetime(2025, 8, 29, 12, 0, 38, tzinfo=TzInfo(+02:00)), subject='Installez kDrive sur vos appareils', messages=[ThreadMessage(uid='4@eJzz9HPyjwAABGYBgQ--', msg_id='begJdqUU0JiUMOxGPv5vjor59rD5WTS17mMwB3Hz8ZU@api-notify-worker-automail-78c4c94cd8-xdsj7', date=datetime.datetime(2025, 8, 29, 12, 0, 38, tzinfo=TzInfo(+02:00)), subject='Installez kDrive sur vos appareils', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')], cc=[], bcc=[], priority='normal', resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/4', download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/4/download', has_attachments=False, seen=True, forwarded=False, answered=False, flagged=False, preview='Installez kDrive sur vos appareils Infomaniak \xa0 [IMG:1797827-hackaton.ch]Infomaniak ** Drive ** \xa0 [endif]--> *Installez kDrive sur vos appareils* [endif]--> [endif]--> [ LINK: https://kdrive.infomania', body=None)]), Thread(uid='eJwryShKTUyxNnZI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2lwLbQ--', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], date=datetime.datetime(2025, 8, 29, 8, 13, 17, tzinfo=TzInfo(+02:00)), subject='Vous avez 1 message non lu dans hackaton.ch', messages=[ThreadMessage(uid='3@eJzz9HPyjwAABGYBgQ--', msg_id='9d34e26b033caec78567a1afb2cd4078@infomaniak.com', date=datetime.datetime(2025, 8, 29, 8, 13, 17, tzinfo=TzInfo(+02:00)), subject='Vous avez 1 message non lu dans hackaton.ch', from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')], to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')], cc=[], bcc=[], priority='normal', resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3', download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3/download', has_attachments=False, seen=True, forwarded=False, answered=False, flagged=False, preview='Infomaniak kChat Infomaniak \xa0 \xa0 Vous avez 1 message non lu dans hackaton.ch Ouvrir kChat 1 message dans vos conversations directes euria jeudi 28 aot 2025 20:24 1 nouveau message Mettez  jour vos pa', body=None)])]
[2025-08-30T17:06:28.410     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51422 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:06:28.410     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51422 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:06:28.410    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 81, in summary_emails
    logger.info(f"Type du premier lment: {type(mails.data[0])}")
                                                 ~~~~~~~~~~^^^
TypeError: 'ListEmailsResponseData' object is not subscriptable
[2025-08-30T17:06:28.410    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 81, in summary_emails
    logger.info(f"Type du premier lment: {type(mails.data[0])}")
                                                 ~~~~~~~~~~^^^
TypeError: 'ListEmailsResponseData' object is not subscriptable
[2025-08-30T17:10:16.851     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:10:16.851  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:10:16.851  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:10:16.921     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:10:16.921     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:10:17.023     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:10:17.023     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:10:17.025     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:10:17.025     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:10:17.025     INFO function=_serve       L0094 file=server.py   ] Finished server process [12468]
[2025-08-30T17:10:17.025     INFO function=_serve       L0094 file=server.py   ] Finished server process [12468]
[2025-08-30T17:10:21.666     INFO function=_serve       L0084 file=server.py   ] Started server process [14908]
[2025-08-30T17:10:21.666     INFO function=_serve       L0084 file=server.py   ] Started server process [14908]
[2025-08-30T17:10:21.667     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:10:21.667     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:10:21.668     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:10:21.668     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:10:21.756     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:10:21.793     INFO function=summary_emai L0072 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:10:22.452     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A10%3A21&stodate=2025-08-30+17%3A10%3A21 "HTTP/1.1 200 OK"
[2025-08-30T17:10:22.456     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52819 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:10:22.456     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52819 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T17:10:22.457    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 79, in summary_emails
    logger.info(f"Type du premier lment: {type(mails.data[0])}")
                                                 ~~~~~~~~~~^^^
TypeError: 'ListEmailsResponseData' object is not subscriptable
[2025-08-30T17:10:22.457    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 79, in summary_emails
    logger.info(f"Type du premier lment: {type(mails.data[0])}")
                                                 ~~~~~~~~~~^^^
TypeError: 'ListEmailsResponseData' object is not subscriptable
[2025-08-30T17:10:48.636     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:10:48.637  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:10:48.637  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:10:48.722     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:10:48.722     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:10:48.836     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:10:48.836     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:10:48.837     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:10:48.837     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:10:48.838     INFO function=_serve       L0094 file=server.py   ] Finished server process [14908]
[2025-08-30T17:10:48.838     INFO function=_serve       L0094 file=server.py   ] Finished server process [14908]
[2025-08-30T17:10:53.093     INFO function=_serve       L0084 file=server.py   ] Started server process [14956]
[2025-08-30T17:10:53.093     INFO function=_serve       L0084 file=server.py   ] Started server process [14956]
[2025-08-30T17:10:53.094     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:10:53.094     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:10:53.095     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:10:53.095     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:10:53.158     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:13:15.626     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:13:15.626  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:13:15.626  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:13:15.640     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:13:15.640     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:13:15.741     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:13:15.741     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:13:15.742     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:13:15.742     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:13:15.742     INFO function=_serve       L0094 file=server.py   ] Finished server process [14956]
[2025-08-30T17:13:15.742     INFO function=_serve       L0094 file=server.py   ] Finished server process [14956]
[2025-08-30T17:13:20.117     INFO function=_serve       L0084 file=server.py   ] Started server process [14968]
[2025-08-30T17:13:20.117     INFO function=_serve       L0084 file=server.py   ] Started server process [14968]
[2025-08-30T17:13:20.118     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:13:20.118     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:13:20.119     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:13:20.119     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:13:20.182     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:15:08.142     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:15:08.143  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:15:08.143  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:15:08.194     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:15:08.194     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:15:08.308     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:15:08.308     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:15:08.308     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:15:08.308     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:15:08.309     INFO function=_serve       L0094 file=server.py   ] Finished server process [14968]
[2025-08-30T17:15:08.309     INFO function=_serve       L0094 file=server.py   ] Finished server process [14968]
[2025-08-30T17:15:12.759     INFO function=_serve       L0084 file=server.py   ] Started server process [14664]
[2025-08-30T17:15:12.759     INFO function=_serve       L0084 file=server.py   ] Started server process [14664]
[2025-08-30T17:15:12.760     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:15:12.760     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:15:12.761     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:15:12.761     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:15:12.849     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:16:04.637     INFO function=summary_emai L0072 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:16:05.351     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A16%3A04&stodate=2025-08-30+17%3A16%3A04 "HTTP/1.1 200 OK"
[2025-08-30T17:16:07.243     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:16:09.061     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:16:09.063     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55056 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T17:16:09.063     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55056 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T17:30:02.478     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:30:02.479  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:30:02.479  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:30:02.524     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:30:02.524     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:30:02.629     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:30:02.629     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:30:02.630     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:30:02.630     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:30:02.630     INFO function=_serve       L0094 file=server.py   ] Finished server process [14664]
[2025-08-30T17:30:02.630     INFO function=_serve       L0094 file=server.py   ] Finished server process [14664]
[2025-08-30T17:30:06.997     INFO function=_serve       L0084 file=server.py   ] Started server process [14792]
[2025-08-30T17:30:06.997     INFO function=_serve       L0084 file=server.py   ] Started server process [14792]
[2025-08-30T17:30:06.998     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:30:06.998     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:30:06.999     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:30:06.999     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:30:07.042     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:31:56.686     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:31:56.686  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:31:56.686  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:31:56.694     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:31:56.694     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:31:56.796     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:31:56.796     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:31:56.797     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:31:56.797     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:31:56.797     INFO function=_serve       L0094 file=server.py   ] Finished server process [14792]
[2025-08-30T17:31:56.797     INFO function=_serve       L0094 file=server.py   ] Finished server process [14792]
[2025-08-30T17:32:01.325     INFO function=_serve       L0084 file=server.py   ] Started server process [3660]
[2025-08-30T17:32:01.325     INFO function=_serve       L0084 file=server.py   ] Started server process [3660]
[2025-08-30T17:32:01.326     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:32:01.326     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:32:01.327     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:32:01.327     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:32:01.382     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:32:43.558     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:32:43.559  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:32:43.559  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T17:32:43.577     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:32:43.577     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:32:43.678     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:32:43.678     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:32:43.679     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:32:43.679     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:32:43.680     INFO function=_serve       L0094 file=server.py   ] Finished server process [3660]
[2025-08-30T17:32:43.680     INFO function=_serve       L0094 file=server.py   ] Finished server process [3660]
[2025-08-30T17:32:47.827     INFO function=_serve       L0084 file=server.py   ] Started server process [5684]
[2025-08-30T17:32:47.827     INFO function=_serve       L0084 file=server.py   ] Started server process [5684]
[2025-08-30T17:32:47.828     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:32:47.828     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:32:47.829     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:32:47.829     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:32:47.898     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:32:53.958     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:32:54.797     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A32%3A53&stodate=2025-08-30+17%3A32%3A53 "HTTP/1.1 200 OK"
[2025-08-30T17:33:03.928     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:33:04.785     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:33:04.787     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49293 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T17:33:04.787     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49293 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T17:43:17.093     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:43:17.097  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:43:17.097  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:43:17.138     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:43:17.138     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:43:17.239     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:43:17.239     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:43:17.240     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:43:17.240     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:43:17.240     INFO function=_serve       L0094 file=server.py   ] Finished server process [5684]
[2025-08-30T17:43:17.240     INFO function=_serve       L0094 file=server.py   ] Finished server process [5684]
[2025-08-30T17:43:19.524     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:43:21.691     INFO function=_serve       L0084 file=server.py   ] Started server process [11872]
[2025-08-30T17:43:21.691     INFO function=_serve       L0084 file=server.py   ] Started server process [11872]
[2025-08-30T17:43:21.692     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:43:21.692     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:43:21.693     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:43:21.693     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:48:14.366     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:48:14.366  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:48:14.366  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:48:14.459     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:48:14.459     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:48:14.566     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:48:14.566     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:48:14.566     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:48:14.566     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:48:14.567     INFO function=_serve       L0094 file=server.py   ] Finished server process [11872]
[2025-08-30T17:48:14.567     INFO function=_serve       L0094 file=server.py   ] Finished server process [11872]
[2025-08-30T17:48:16.718     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:50:24.702     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:50:24.703  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:50:24.703  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:50:26.467     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:50:28.645     INFO function=_serve       L0084 file=server.py   ] Started server process [14056]
[2025-08-30T17:50:28.645     INFO function=_serve       L0084 file=server.py   ] Started server process [14056]
[2025-08-30T17:50:28.646     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:50:28.646     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:50:28.647     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:50:28.647     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:55:08.495     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T17:55:08.496  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:55:08.496  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T17:55:08.567     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:55:08.567     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T17:55:08.683     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:55:08.683     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T17:55:08.684     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:55:08.684     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T17:55:08.685     INFO function=_serve       L0094 file=server.py   ] Finished server process [14056]
[2025-08-30T17:55:08.685     INFO function=_serve       L0094 file=server.py   ] Finished server process [14056]
[2025-08-30T17:55:11.090     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T17:55:13.367     INFO function=_serve       L0084 file=server.py   ] Started server process [10092]
[2025-08-30T17:55:13.367     INFO function=_serve       L0084 file=server.py   ] Started server process [10092]
[2025-08-30T17:55:13.368     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:55:13.368     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T17:55:13.368     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:55:13.368     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T17:55:16.030     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T17:55:16.728     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+17%3A55%3A16&stodate=2025-08-30+17%3A55%3A16 "HTTP/1.1 200 OK"
[2025-08-30T17:55:21.664     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:55:23.863     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T17:55:23.865    ERROR function=correct_json L0155 file=mail.py     ] Error parsing JSON: 'DailyResponse' object has no attribute 'description'. Using fallback values.
[2025-08-30T17:55:23.866     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T17:55:23.866     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T18:00:21.024     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T18:00:21.725     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+18%3A00%3A21&stodate=2025-08-30+18%3A00%3A21 "HTTP/1.1 200 OK"
[2025-08-30T18:00:26.545     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T18:00:28.156     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T18:00:28.157    ERROR function=correct_json L0155 file=mail.py     ] Error parsing JSON: 'DailyResponse' object has no attribute 'description'. Using fallback values.
[2025-08-30T18:00:28.158     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64892 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T18:00:28.158     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64892 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T18:07:25.364     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:07:25.365  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:07:25.365  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:07:25.456     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:07:25.456     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:07:25.557     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:07:25.557     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:07:25.558     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:07:25.558     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:07:25.558     INFO function=_serve       L0094 file=server.py   ] Finished server process [10092]
[2025-08-30T18:07:25.558     INFO function=_serve       L0094 file=server.py   ] Finished server process [10092]
[2025-08-30T18:07:30.123     INFO function=_serve       L0084 file=server.py   ] Started server process [4708]
[2025-08-30T18:07:30.123     INFO function=_serve       L0084 file=server.py   ] Started server process [4708]
[2025-08-30T18:07:30.124     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:07:30.124     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:07:30.124     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:07:30.124     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:07:30.182     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T18:08:19.303     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:08:19.304  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:08:19.304  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:08:19.359     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:08:19.359     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:08:19.461     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:08:19.461     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:08:19.462     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:08:19.462     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:08:19.462     INFO function=_serve       L0094 file=server.py   ] Finished server process [4708]
[2025-08-30T18:08:19.462     INFO function=_serve       L0094 file=server.py   ] Finished server process [4708]
[2025-08-30T18:08:23.849  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T18:08:23.858     INFO function=_serve       L0084 file=server.py   ] Started server process [14312]
[2025-08-30T18:08:23.858     INFO function=_serve       L0084 file=server.py   ] Started server process [14312]
[2025-08-30T18:08:23.859     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:08:23.859     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:08:23.860     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:08:23.860     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:08:23.915     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T18:09:58.109     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:09:58.110  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:09:58.110  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:09:58.193     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:09:58.193     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:09:58.307     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:09:58.307     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:09:58.307     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:09:58.307     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:09:58.308     INFO function=_serve       L0094 file=server.py   ] Finished server process [14312]
[2025-08-30T18:09:58.308     INFO function=_serve       L0094 file=server.py   ] Finished server process [14312]
[2025-08-30T18:10:02.522  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T18:10:02.529     INFO function=_serve       L0084 file=server.py   ] Started server process [10600]
[2025-08-30T18:10:02.529     INFO function=_serve       L0084 file=server.py   ] Started server process [10600]
[2025-08-30T18:10:02.530     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:10:02.530     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:10:02.531     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:10:02.531     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:10:02.584     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T18:10:27.534     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:10:27.535  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:10:27.535  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:10:27.577     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:10:27.577     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:10:27.679     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:10:27.679     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:10:27.680     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:10:27.680     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:10:27.680     INFO function=_serve       L0094 file=server.py   ] Finished server process [10600]
[2025-08-30T18:10:27.680     INFO function=_serve       L0094 file=server.py   ] Finished server process [10600]
[2025-08-30T18:10:31.973  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T18:10:31.980     INFO function=_serve       L0084 file=server.py   ] Started server process [14804]
[2025-08-30T18:10:31.980     INFO function=_serve       L0084 file=server.py   ] Started server process [14804]
[2025-08-30T18:10:31.981     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:10:31.981     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:10:31.982     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:10:31.982     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:10:32.049     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T18:29:49.632     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:29:49.633  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:29:49.633  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:29:49.637     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:29:49.637     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:29:49.739     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:29:49.739     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:29:49.741     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:29:49.741     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:29:49.742     INFO function=_serve       L0094 file=server.py   ] Finished server process [14804]
[2025-08-30T18:29:49.742     INFO function=_serve       L0094 file=server.py   ] Finished server process [14804]
[2025-08-30T18:29:54.715  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T18:29:54.722     INFO function=_serve       L0084 file=server.py   ] Started server process [4804]
[2025-08-30T18:29:54.722     INFO function=_serve       L0084 file=server.py   ] Started server process [4804]
[2025-08-30T18:29:54.723     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:29:54.723     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T18:29:54.724     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:29:54.724     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T18:29:54.783     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T18:43:14.103     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T18:43:14.103  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:43:14.103  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T18:43:14.167     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:43:14.167     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T18:43:14.282     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:43:14.282     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T18:43:14.283     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:43:14.283     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T18:43:14.284     INFO function=_serve       L0094 file=server.py   ] Finished server process [4804]
[2025-08-30T18:43:14.284     INFO function=_serve       L0094 file=server.py   ] Finished server process [4804]
[2025-08-30T18:43:18.561     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:03:45.077     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:03:45.078  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:03:45.078  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:03:49.089  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:03:49.097     INFO function=_serve       L0084 file=server.py   ] Started server process [2604]
[2025-08-30T19:03:49.097     INFO function=_serve       L0084 file=server.py   ] Started server process [2604]
[2025-08-30T19:03:49.098     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:03:49.098     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:03:49.098     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:03:49.098     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:03:49.160     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:09:20.606     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:09:20.606     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:09:20.728     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:09:20.728     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:09:20.728     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:09:20.728     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:09:20.729     INFO function=_serve       L0094 file=server.py   ] Finished server process [2604]
[2025-08-30T19:09:20.729     INFO function=_serve       L0094 file=server.py   ] Finished server process [2604]
[2025-08-30T19:10:25.654     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-30T19:10:25.654     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-30T19:10:25.655     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-30T19:10:25.655     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-30T19:10:25.655     INFO function=startup      L0080 file=basereload.p] Started reloader process [6060] using WatchFiles
[2025-08-30T19:10:25.655     INFO function=startup      L0080 file=basereload.p] Started reloader process [6060] using WatchFiles
[2025-08-30T19:10:30.241  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:10:30.248     INFO function=_serve       L0084 file=server.py   ] Started server process [10568]
[2025-08-30T19:10:30.248     INFO function=_serve       L0084 file=server.py   ] Started server process [10568]
[2025-08-30T19:10:30.250     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:10:30.250     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:10:30.252     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:10:30.252     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:11:48.477     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:11:48.478  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:11:48.478  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:11:48.494     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:11:48.497  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:11:48.497  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:11:48.531     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:11:48.531     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:11:48.632     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:11:48.632     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:11:48.633     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:11:48.633     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:11:48.634     INFO function=_serve       L0094 file=server.py   ] Finished server process [10568]
[2025-08-30T19:11:48.634     INFO function=_serve       L0094 file=server.py   ] Finished server process [10568]
[2025-08-30T19:11:53.055     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:11:53.074  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:11:53.084     INFO function=_serve       L0084 file=server.py   ] Started server process [10492]
[2025-08-30T19:11:53.084     INFO function=_serve       L0084 file=server.py   ] Started server process [10492]
[2025-08-30T19:11:53.086     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:11:53.086     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:11:53.087     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:11:53.087     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:12:42.791     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:12:42.792  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:12:42.792  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:12:42.853     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:12:42.853     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:12:42.965     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:12:42.965     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:12:42.966     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:12:42.966     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:12:42.967     INFO function=_serve       L0094 file=server.py   ] Finished server process [10492]
[2025-08-30T19:12:42.967     INFO function=_serve       L0094 file=server.py   ] Finished server process [10492]
[2025-08-30T19:12:47.015  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:12:47.022     INFO function=_serve       L0084 file=server.py   ] Started server process [1356]
[2025-08-30T19:12:47.022     INFO function=_serve       L0084 file=server.py   ] Started server process [1356]
[2025-08-30T19:12:47.022     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:12:47.022     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:12:47.023     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:12:47.023     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:12:47.104     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:13:10.322     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:13:11.132     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A13%3A10&stodate=2025-08-30+19%3A13%3A10 "HTTP/1.1 200 OK"
[2025-08-30T19:13:12.979     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:13:14.511     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:13:14.512     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52175 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:13:14.512     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52175 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:19:39.168     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:19:39.168  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:19:39.168  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:19:39.224     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:19:39.224     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:19:39.339     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:19:39.339     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:19:39.340     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:19:39.340     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:19:39.341     INFO function=_serve       L0094 file=server.py   ] Finished server process [1356]
[2025-08-30T19:19:39.341     INFO function=_serve       L0094 file=server.py   ] Finished server process [1356]
[2025-08-30T19:19:44.209  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:19:44.247     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:20:50.793     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:20:50.794  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:20:50.794  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:20:54.517  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:20:54.525     INFO function=_serve       L0084 file=server.py   ] Started server process [14820]
[2025-08-30T19:20:54.525     INFO function=_serve       L0084 file=server.py   ] Started server process [14820]
[2025-08-30T19:20:54.526     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:20:54.526     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:20:54.527     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:20:54.527     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:20:54.577     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:21:52.278     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:21:52.985     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A21%3A52&stodate=2025-08-30+19%3A21%3A52 "HTTP/1.1 200 OK"
[2025-08-30T19:21:55.096     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:21:58.100     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:21:58.102    ERROR function=correct_json L0155 file=mail.py     ] Error parsing JSON: 'DailyResponse' object has no attribute 'description'. Using fallback values.
[2025-08-30T19:21:58.103     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50676 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:21:58.103     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50676 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:29:26.875     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:29:26.876  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T19:29:26.876  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T19:29:26.948     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:29:26.948     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:29:27.052     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:29:27.052     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:29:27.053     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:29:27.053     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:29:27.053     INFO function=_serve       L0094 file=server.py   ] Finished server process [14820]
[2025-08-30T19:29:27.053     INFO function=_serve       L0094 file=server.py   ] Finished server process [14820]
[2025-08-30T19:29:29.400     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:29:31.478  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:29:31.487     INFO function=_serve       L0084 file=server.py   ] Started server process [13736]
[2025-08-30T19:29:31.487     INFO function=_serve       L0084 file=server.py   ] Started server process [13736]
[2025-08-30T19:29:31.488     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:29:31.488     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:29:31.488     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:29:31.488     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:29:40.727     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:29:41.499     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A29%3A40&stodate=2025-08-30+19%3A29%3A40 "HTTP/1.1 200 OK"
[2025-08-30T19:29:43.627     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:29:43.974     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:29:43.976     INFO function=send         L0476 file=httptools_im] 127.0.0.1:56198 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:29:43.976     INFO function=send         L0476 file=httptools_im] 127.0.0.1:56198 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:36:48.026     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:36:48.026  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:36:48.026  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:36:48.041     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:36:48.041     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:36:48.145     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:36:48.145     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:36:48.146     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:36:48.146     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:36:48.146     INFO function=_serve       L0094 file=server.py   ] Finished server process [13736]
[2025-08-30T19:36:48.146     INFO function=_serve       L0094 file=server.py   ] Finished server process [13736]
[2025-08-30T19:36:52.532  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:36:52.539     INFO function=_serve       L0084 file=server.py   ] Started server process [11684]
[2025-08-30T19:36:52.539     INFO function=_serve       L0084 file=server.py   ] Started server process [11684]
[2025-08-30T19:36:52.540     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:36:52.540     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:36:52.540     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:36:52.540     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:36:52.612     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:37:02.514     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:37:03.293     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A37%3A02&stodate=2025-08-30+19%3A37%3A02 "HTTP/1.1 200 OK"
[2025-08-30T19:37:03.295     INFO function=summary_emai L0137 file=daily.py    ] Nombre de threads rcuprs : 6
[2025-08-30T19:37:03.297     INFO function=summary_emai L0139 file=daily.py    ] Premier thread : {'uid': 'eJwryShKTUyxtnBI9aqqsvQIqMwqd3R0co90Sg_U1XXw9HPyjwAA2ugLcg--', 'from_': [{'email': 'timothee.frily2@hackaton.ch', 'name': ''}], 'to': [{'email': 'loic.gosselke@hackaton.ch', 'name': 'Loc Gosselke'}], 'cc': [], 'bcc': [], 'date': datetime.datetime(2025, 8, 30, 17, 59, 15, tzinfo=TzInfo(+02:00)), 'subject': 'Organisation rdv', 'messages': [{'uid': '8@eJzz9HPyjwAABGYBgQ--', 'msg_id': 'b2a8c197-c595-4b50-85fc-9adbbdb1eb9d@mail.infomaniak.com', 'date': datetime.datetime(2025, 8, 30, 17, 59, 15, tzinfo=TzInfo(+02:00)), 'subject': 'Organisation rdv', 'from_': [{'email': 'timothee.frily2@hackaton.ch', 'name': ''}], 'to': [{'email': 'loic.gosselke@hackaton.ch', 'name': 'Loc Gosselke'}], 'cc': [], 'bcc': [], 'priority': 'normal', 'resource': '/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/8', 'download_resource': '/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/8/download', 'has_attachments': False, 'seen': True, 'forwarded': False, 'answered': False, 'flagged': False, 'preview': "Bonjour Loic, Contact moi pour qu'on organise notre escapade au antilles. Passe une bonne journer Cordialement, Timothee Frily", 'body': None}]}
[2025-08-30T19:37:05.602     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:37:05.883     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:37:05.885     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54820 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:37:05.885     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54820 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:38:36.928     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:38:36.928  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:38:36.928  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:38:36.975     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:38:36.975     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:38:37.078     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:38:37.078     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:38:37.079     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:38:37.079     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:38:37.080     INFO function=_serve       L0094 file=server.py   ] Finished server process [11684]
[2025-08-30T19:38:37.080     INFO function=_serve       L0094 file=server.py   ] Finished server process [11684]
[2025-08-30T19:38:41.502  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:38:41.511     INFO function=_serve       L0084 file=server.py   ] Started server process [8116]
[2025-08-30T19:38:41.511     INFO function=_serve       L0084 file=server.py   ] Started server process [8116]
[2025-08-30T19:38:41.512     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:38:41.512     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:38:41.513     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:38:41.513     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:38:41.582     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:38:42.729     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:38:43.460     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A38%3A42&stodate=2025-08-30+19%3A38%3A42 "HTTP/1.1 200 OK"
[2025-08-30T19:38:45.595     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:38:46.115     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:38:46.117     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52816 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:38:46.117     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52816 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:39:34.558     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:39:34.559  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:39:34.559  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:39:34.659     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:39:34.659     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:39:34.773     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:39:34.773     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:39:34.774     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:39:34.774     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:39:34.774     INFO function=_serve       L0094 file=server.py   ] Finished server process [8116]
[2025-08-30T19:39:34.774     INFO function=_serve       L0094 file=server.py   ] Finished server process [8116]
[2025-08-30T19:39:38.834  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:39:38.841     INFO function=_serve       L0084 file=server.py   ] Started server process [8724]
[2025-08-30T19:39:38.841     INFO function=_serve       L0084 file=server.py   ] Started server process [8724]
[2025-08-30T19:39:38.842     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:39:38.842     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:39:38.843     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:39:38.843     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:39:38.915     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:39:51.407     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:39:51.408  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:39:51.408  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:39:51.478     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:39:51.478     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:39:51.592     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:39:51.592     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:39:51.593     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:39:51.593     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:39:51.594     INFO function=_serve       L0094 file=server.py   ] Finished server process [8724]
[2025-08-30T19:39:51.594     INFO function=_serve       L0094 file=server.py   ] Finished server process [8724]
[2025-08-30T19:39:55.900  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:39:55.907     INFO function=_serve       L0084 file=server.py   ] Started server process [15124]
[2025-08-30T19:39:55.907     INFO function=_serve       L0084 file=server.py   ] Started server process [15124]
[2025-08-30T19:39:55.907     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:39:55.907     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:39:55.908     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:39:55.908     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:39:55.967     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:39:58.849     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:39:59.619     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A39%3A58&stodate=2025-08-30+19%3A39%3A58 "HTTP/1.1 200 OK"
[2025-08-30T19:40:01.467     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:40:01.824     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:40:01.826     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51982 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:40:01.826     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51982 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:40:32.187     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:40:32.188  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:40:32.188  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:40:32.244     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:40:32.244     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:40:32.345     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:40:32.345     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:40:32.346     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:40:32.346     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:40:32.347     INFO function=_serve       L0094 file=server.py   ] Finished server process [15124]
[2025-08-30T19:40:32.347     INFO function=_serve       L0094 file=server.py   ] Finished server process [15124]
[2025-08-30T19:40:36.654  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:40:36.661     INFO function=_serve       L0084 file=server.py   ] Started server process [13556]
[2025-08-30T19:40:36.661     INFO function=_serve       L0084 file=server.py   ] Started server process [13556]
[2025-08-30T19:40:36.662     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:40:36.662     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:40:36.663     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:40:36.663     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:40:36.716     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:42:08.981     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:42:08.982  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:08.982  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:08.995     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:42:08.995     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:42:09.099     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:42:09.099     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:42:09.099     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:42:09.099     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:42:09.100     INFO function=_serve       L0094 file=server.py   ] Finished server process [13556]
[2025-08-30T19:42:09.100     INFO function=_serve       L0094 file=server.py   ] Finished server process [13556]
[2025-08-30T19:42:13.143  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:42:13.150     INFO function=_serve       L0084 file=server.py   ] Started server process [14008]
[2025-08-30T19:42:13.150     INFO function=_serve       L0084 file=server.py   ] Started server process [14008]
[2025-08-30T19:42:13.151     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:42:13.151     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:42:13.152     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:42:13.152     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:42:13.200     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:42:16.626     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:42:17.365     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A42%3A16&stodate=2025-08-30+19%3A42%3A16 "HTTP/1.1 200 OK"
[2025-08-30T19:42:17.367     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53675 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:42:17.367     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53675 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:42:17.368    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T19:42:17.368    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T19:42:35.858     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:42:35.859  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:35.859  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:35.946     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:42:35.946     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:42:36.060     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:42:36.060     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:42:36.061     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:42:36.061     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:42:36.062     INFO function=_serve       L0094 file=server.py   ] Finished server process [14008]
[2025-08-30T19:42:36.062     INFO function=_serve       L0094 file=server.py   ] Finished server process [14008]
[2025-08-30T19:42:53.219     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:42:53.220  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:53.220  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:42:57.021  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:42:57.027     INFO function=_serve       L0084 file=server.py   ] Started server process [7128]
[2025-08-30T19:42:57.027     INFO function=_serve       L0084 file=server.py   ] Started server process [7128]
[2025-08-30T19:42:57.028     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:42:57.028     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:42:57.029     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:42:57.029     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:42:57.105     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:43:02.120     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:43:02.121     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51644 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:43:02.121     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51644 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:43:02.122    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 130, in summary_emails
    from_date=datetime.datetime.now() - datetime.timedelta(days=1),
              ^^^^^^^^^^^^^^^^^
AttributeError: type object 'datetime.datetime' has no attribute 'datetime'
[2025-08-30T19:43:02.122    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 130, in summary_emails
    from_date=datetime.datetime.now() - datetime.timedelta(days=1),
              ^^^^^^^^^^^^^^^^^
AttributeError: type object 'datetime.datetime' has no attribute 'datetime'
[2025-08-30T19:43:26.489     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:43:26.490  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:43:26.490  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:43:26.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:43:26.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:43:26.631     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:43:26.631     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:43:26.631     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:43:26.631     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:43:26.632     INFO function=_serve       L0094 file=server.py   ] Finished server process [7128]
[2025-08-30T19:43:26.632     INFO function=_serve       L0094 file=server.py   ] Finished server process [7128]
[2025-08-30T19:43:30.812  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:43:30.823     INFO function=_serve       L0084 file=server.py   ] Started server process [3408]
[2025-08-30T19:43:30.823     INFO function=_serve       L0084 file=server.py   ] Started server process [3408]
[2025-08-30T19:43:30.823     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:43:30.823     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:43:30.824     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:43:30.824     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:43:30.870     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:43:41.090     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:43:41.833     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A43%3A41&stodate=2025-08-30+19%3A43%3A41 "HTTP/1.1 200 OK"
[2025-08-30T19:43:41.835     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51650 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:43:41.835     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51650 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:43:41.837    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T19:43:41.837    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T19:44:19.615     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:44:19.617  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:44:19.617  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:44:19.647     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:44:19.647     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:44:19.749     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:44:19.749     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:44:19.750     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:44:19.750     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:44:19.751     INFO function=_serve       L0094 file=server.py   ] Finished server process [3408]
[2025-08-30T19:44:19.751     INFO function=_serve       L0094 file=server.py   ] Finished server process [3408]
[2025-08-30T19:44:24.289  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:44:24.297     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T19:44:24.297     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T19:44:24.298     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:44:24.298     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:44:24.299     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:44:24.299     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:44:24.344     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:44:24.359     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:44:25.024     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A44%3A24&stodate=2025-08-30+19%3A44%3A24 "HTTP/1.1 200 OK"
[2025-08-30T19:44:25.027     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55670 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:44:25.027     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55670 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:44:25.027    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.datatime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'datatime'. Did you mean: 'datetime'?
[2025-08-30T19:44:25.027    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 196, in summary_emails
    date=datetime.datatime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'datatime'. Did you mean: 'datetime'?
[2025-08-30T19:44:35.754     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:44:35.755  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:44:35.755  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:44:35.849     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:44:35.849     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:44:35.961     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:44:35.961     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:44:35.962     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:44:35.962     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:44:35.962     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T19:44:35.962     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T19:44:40.435  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:44:40.442     INFO function=_serve       L0084 file=server.py   ] Started server process [6372]
[2025-08-30T19:44:40.442     INFO function=_serve       L0084 file=server.py   ] Started server process [6372]
[2025-08-30T19:44:40.443     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:44:40.443     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:44:40.444     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:44:40.444     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:44:40.483     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:44:40.500     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:44:41.143     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A44%3A40&stodate=2025-08-30+19%3A44%3A40 "HTTP/1.1 200 OK"
[2025-08-30T19:44:41.149     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:44:41.149     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T19:45:13.578     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:45:13.579  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:45:13.579  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:45:13.596     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:45:13.596     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:45:13.698     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:45:13.698     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:45:13.699     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:45:13.699     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:45:13.701     INFO function=_serve       L0094 file=server.py   ] Finished server process [6372]
[2025-08-30T19:45:13.701     INFO function=_serve       L0094 file=server.py   ] Finished server process [6372]
[2025-08-30T19:45:17.910  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:45:17.918     INFO function=_serve       L0084 file=server.py   ] Started server process [11568]
[2025-08-30T19:45:17.918     INFO function=_serve       L0084 file=server.py   ] Started server process [11568]
[2025-08-30T19:45:17.919     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:45:17.919     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:45:17.919     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:45:17.919     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:45:17.971     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T19:45:24.557     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T19:45:25.260     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+19%3A45%3A24&stodate=2025-08-30+19%3A45%3A24 "HTTP/1.1 200 OK"
[2025-08-30T19:45:26.960     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T19:45:26.977     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57196 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:45:26.977     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57196 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T19:45:26.978    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 210, in summary_emails
    result = event_chain.invoke({
        "emails": ", ".join(emails),
        "text": context_for_llm
    })
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: No emails provided in the input. [type=value_error, input_value=['No emails provided in the input.'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T19:45:26.978    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 210, in summary_emails
    result = event_chain.invoke({
        "emails": ", ".join(emails),
        "text": context_for_llm
    })
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: No emails provided in the input. [type=value_error, input_value=['No emails provided in the input.'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T19:51:28.758     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T19:51:28.759  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:51:28.759  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T19:51:28.822     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:51:28.822     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T19:51:28.924     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:51:28.924     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T19:51:28.925     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:51:28.925     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T19:51:28.925     INFO function=_serve       L0094 file=server.py   ] Finished server process [11568]
[2025-08-30T19:51:28.925     INFO function=_serve       L0094 file=server.py   ] Finished server process [11568]
[2025-08-30T19:51:33.688  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T19:51:33.695     INFO function=_serve       L0084 file=server.py   ] Started server process [15344]
[2025-08-30T19:51:33.695     INFO function=_serve       L0084 file=server.py   ] Started server process [15344]
[2025-08-30T19:51:33.696     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:51:33.696     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T19:51:33.697     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:51:33.697     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T19:51:33.767     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:11:32.975     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:11:33.751     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A11%3A32&stodate=2025-08-30+20%3A11%3A32 "HTTP/1.1 200 OK"
[2025-08-30T20:11:35.793     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:11:36.310     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:11:36.313     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63697 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:11:36.313     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63697 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:13:04.708     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:13:04.708  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:13:04.708  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:13:04.769     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:13:04.769     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:13:04.871     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:13:04.871     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:13:04.872     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:13:04.872     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:13:04.872     INFO function=_serve       L0094 file=server.py   ] Finished server process [15344]
[2025-08-30T20:13:04.872     INFO function=_serve       L0094 file=server.py   ] Finished server process [15344]
[2025-08-30T20:13:10.160  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:13:10.168     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T20:13:10.168     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T20:13:10.169     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:13:10.169     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:13:10.169     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:13:10.169     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:13:10.238     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:14:31.084     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:14:31.797     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A14%3A31&stodate=2025-08-30+20%3A14%3A31 "HTTP/1.1 200 OK"
[2025-08-30T20:14:33.363     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:14:35.921     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:14:35.924     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50513 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:14:35.924     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50513 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:14:58.120     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:14:58.121  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:14:58.121  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:14:58.203     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:14:58.203     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:14:58.319     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:14:58.319     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:14:58.320     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:14:58.320     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:14:58.321     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T20:14:58.321     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T20:15:02.961  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:15:02.970     INFO function=_serve       L0084 file=server.py   ] Started server process [7652]
[2025-08-30T20:15:02.970     INFO function=_serve       L0084 file=server.py   ] Started server process [7652]
[2025-08-30T20:15:02.971     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:02.971     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:02.972     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:02.972     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:03.022     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:15:03.029     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:15:03.702     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A15%3A03&stodate=2025-08-30+20%3A15%3A03 "HTTP/1.1 200 OK"
[2025-08-30T20:15:05.358     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:15:05.721     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:15:05.723     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50521 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:15:05.723     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50521 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:15:13.987     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:15:13.988  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:15:13.988  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:15:14.038     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:15:14.038     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:15:14.139     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:15:14.139     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:15:14.142     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:15:14.142     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:15:14.143     INFO function=_serve       L0094 file=server.py   ] Finished server process [7652]
[2025-08-30T20:15:14.143     INFO function=_serve       L0094 file=server.py   ] Finished server process [7652]
[2025-08-30T20:15:18.313  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:15:18.320     INFO function=_serve       L0084 file=server.py   ] Started server process [1640]
[2025-08-30T20:15:18.320     INFO function=_serve       L0084 file=server.py   ] Started server process [1640]
[2025-08-30T20:15:18.321     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:18.321     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:18.322     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:18.322     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:18.375     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:15:29.315     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:15:29.317  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:15:29.317  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:15:29.344     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:15:29.344     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:15:29.456     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:15:29.456     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:15:29.457     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:15:29.457     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:15:29.457     INFO function=_serve       L0094 file=server.py   ] Finished server process [1640]
[2025-08-30T20:15:29.457     INFO function=_serve       L0094 file=server.py   ] Finished server process [1640]
[2025-08-30T20:15:33.827  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:15:33.835     INFO function=_serve       L0084 file=server.py   ] Started server process [15032]
[2025-08-30T20:15:33.835     INFO function=_serve       L0084 file=server.py   ] Started server process [15032]
[2025-08-30T20:15:33.836     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:33.836     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:15:33.837     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:33.837     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:15:33.889     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:15:38.200     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:15:38.915     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A15%3A38&stodate=2025-08-30+20%3A15%3A38 "HTTP/1.1 200 OK"
[2025-08-30T20:15:40.558     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:15:41.050     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:15:41.054     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50901 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:15:41.054     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50901 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:16:42.451     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:16:42.451  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:16:42.451  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:16:42.474     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:16:42.474     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:16:42.588     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:16:42.588     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:16:42.590     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:16:42.590     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:16:42.590     INFO function=_serve       L0094 file=server.py   ] Finished server process [15032]
[2025-08-30T20:16:42.590     INFO function=_serve       L0094 file=server.py   ] Finished server process [15032]
[2025-08-30T20:16:46.755  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:16:46.762     INFO function=_serve       L0084 file=server.py   ] Started server process [6488]
[2025-08-30T20:16:46.762     INFO function=_serve       L0084 file=server.py   ] Started server process [6488]
[2025-08-30T20:16:46.763     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:16:46.763     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:16:46.764     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:16:46.764     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:16:46.795     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:16:49.352     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:16:50.098     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A16%3A49&stodate=2025-08-30+20%3A16%3A49 "HTTP/1.1 200 OK"
[2025-08-30T20:16:51.815     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:16:52.323     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:16:52.324     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53220 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:16:52.324     INFO function=send         L0476 file=httptools_im] 127.0.0.1:53220 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:17:28.628     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:17:28.628  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:17:28.628  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:17:28.639     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:17:28.639     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:17:28.755     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:17:28.755     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:17:28.756     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:17:28.756     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:17:28.757     INFO function=_serve       L0094 file=server.py   ] Finished server process [6488]
[2025-08-30T20:17:28.757     INFO function=_serve       L0094 file=server.py   ] Finished server process [6488]
[2025-08-30T20:17:33.216  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:17:33.224     INFO function=_serve       L0084 file=server.py   ] Started server process [4888]
[2025-08-30T20:17:33.224     INFO function=_serve       L0084 file=server.py   ] Started server process [4888]
[2025-08-30T20:17:33.225     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:17:33.225     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:17:33.225     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:17:33.225     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:17:33.261     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:17:33.266     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:17:33.937     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A17%3A33&stodate=2025-08-30+20%3A17%3A33 "HTTP/1.1 200 OK"
[2025-08-30T20:17:33.943     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65455 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:17:33.943     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65455 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:17:33.944    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 160, in summary_emails
    raw_body = message.body.value or ""
               ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:17:33.944    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 160, in summary_emails
    raw_body = message.body.value or ""
               ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:20:12.143     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:20:12.144  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:20:12.144  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:20:12.258     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:20:12.258     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:20:12.375     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:20:12.375     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:20:12.376     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:20:12.376     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:20:12.376     INFO function=_serve       L0094 file=server.py   ] Finished server process [4888]
[2025-08-30T20:20:12.376     INFO function=_serve       L0094 file=server.py   ] Finished server process [4888]
[2025-08-30T20:20:16.709  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:20:16.716     INFO function=_serve       L0084 file=server.py   ] Started server process [10480]
[2025-08-30T20:20:16.716     INFO function=_serve       L0084 file=server.py   ] Started server process [10480]
[2025-08-30T20:20:16.717     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:20:16.717     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:20:16.718     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:20:16.718     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:20:16.754     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:20:21.123     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:20:21.809     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A20%3A21&stodate=2025-08-30+20%3A20%3A21 "HTTP/1.1 200 OK"
[2025-08-30T20:20:23.692     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:20:24.257     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:20:24.260     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50646 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:20:24.260     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50646 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:21:09.462     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:21:09.463  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:21:09.463  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:21:09.560     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:21:09.560     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:21:09.675     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:21:09.675     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:21:09.677     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:21:09.677     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:21:09.677     INFO function=_serve       L0094 file=server.py   ] Finished server process [10480]
[2025-08-30T20:21:09.677     INFO function=_serve       L0094 file=server.py   ] Finished server process [10480]
[2025-08-30T20:21:14.111  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:21:14.151     INFO function=_serve       L0084 file=server.py   ] Started server process [11456]
[2025-08-30T20:21:14.151     INFO function=_serve       L0084 file=server.py   ] Started server process [11456]
[2025-08-30T20:21:14.152     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:21:14.152     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:21:14.152     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:21:14.152     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:21:14.155     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:21:14.204     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:21:14.888     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A21%3A14&stodate=2025-08-30+20%3A21%3A14 "HTTP/1.1 200 OK"
[2025-08-30T20:21:14.890     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64152 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:21:14.890     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64152 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:21:14.891    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 141, in summary_emails
    date = mail.date.strftime("%A %d. %B %Y")
           ^^^^
NameError: name 'mail' is not defined. Did you mean: 'mails'?
[2025-08-30T20:21:14.891    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 141, in summary_emails
    date = mail.date.strftime("%A %d. %B %Y")
           ^^^^
NameError: name 'mail' is not defined. Did you mean: 'mails'?
[2025-08-30T20:21:49.560     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:21:49.560  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:21:49.560  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:21:49.574     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:21:49.574     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:21:49.678     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:21:49.678     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:21:49.679     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:21:49.679     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:21:49.679     INFO function=_serve       L0094 file=server.py   ] Finished server process [11456]
[2025-08-30T20:21:49.679     INFO function=_serve       L0094 file=server.py   ] Finished server process [11456]
[2025-08-30T20:21:53.852  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:21:53.859     INFO function=_serve       L0084 file=server.py   ] Started server process [9124]
[2025-08-30T20:21:53.859     INFO function=_serve       L0084 file=server.py   ] Started server process [9124]
[2025-08-30T20:21:53.860     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:21:53.860     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:21:53.860     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:21:53.860     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:21:53.913     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:21:55.307     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:21:55.983     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A21%3A55&stodate=2025-08-30+20%3A21%3A55 "HTTP/1.1 200 OK"
[2025-08-30T20:21:55.985     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57624 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:21:55.985     INFO function=send         L0476 file=httptools_im] 127.0.0.1:57624 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:21:55.986    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 145, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:21:55.986    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 145, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:22:40.494     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:22:40.495  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:22:40.495  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:22:40.530     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:22:40.530     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:22:40.644     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:22:40.644     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:22:40.645     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:22:40.645     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:22:40.646     INFO function=_serve       L0094 file=server.py   ] Finished server process [9124]
[2025-08-30T20:22:40.646     INFO function=_serve       L0094 file=server.py   ] Finished server process [9124]
[2025-08-30T20:23:16.005     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:23:16.006  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:23:16.006  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:23:20.083  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:23:20.093     INFO function=_serve       L0084 file=server.py   ] Started server process [13220]
[2025-08-30T20:23:20.093     INFO function=_serve       L0084 file=server.py   ] Started server process [13220]
[2025-08-30T20:23:20.094     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:23:20.094     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:23:20.096     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:23:20.096     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:23:20.146     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:23:20.157     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:23:20.814     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A23%3A20&stodate=2025-08-30+20%3A23%3A20 "HTTP/1.1 200 OK"
[2025-08-30T20:23:26.339     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:23:28.545     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:23:28.552     INFO function=summary_emai L0125 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:23:29.226     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A23%3A28&stodate=2025-08-30+20%3A23%3A28 "HTTP/1.1 200 OK"
[2025-08-30T20:23:32.212     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:23:33.664     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:23:33.666     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55031 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:23:33.666     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55031 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:24:17.434     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:24:17.435  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:24:17.435  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:24:17.519     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:24:17.519     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:24:17.628     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:24:17.628     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:24:17.629     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:24:17.629     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:24:17.630     INFO function=_serve       L0094 file=server.py   ] Finished server process [13220]
[2025-08-30T20:24:17.630     INFO function=_serve       L0094 file=server.py   ] Finished server process [13220]
[2025-08-30T20:24:21.899  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:24:21.908     INFO function=_serve       L0084 file=server.py   ] Started server process [12892]
[2025-08-30T20:24:21.908     INFO function=_serve       L0084 file=server.py   ] Started server process [12892]
[2025-08-30T20:24:21.908     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:24:21.908     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:24:21.909     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:24:21.909     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:24:21.984     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:28:45.429     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:28:45.430  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:28:45.430  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:28:45.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:28:45.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:28:45.634     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:28:45.634     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:28:45.635     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:28:45.635     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:28:45.635     INFO function=_serve       L0094 file=server.py   ] Finished server process [12892]
[2025-08-30T20:28:45.635     INFO function=_serve       L0094 file=server.py   ] Finished server process [12892]
[2025-08-30T20:28:50.006  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:28:50.013     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T20:28:50.013     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T20:28:50.014     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:28:50.014     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:28:50.015     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:28:50.015     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:28:50.054     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:30:53.691     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:30:53.692  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:30:53.692  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:30:53.753     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:30:53.753     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:30:53.868     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:30:53.868     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:30:53.870     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:30:53.870     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:30:53.870     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T20:30:53.870     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T20:30:58.062     INFO function=_serve       L0084 file=server.py   ] Started server process [13060]
[2025-08-30T20:30:58.062     INFO function=_serve       L0084 file=server.py   ] Started server process [13060]
[2025-08-30T20:30:58.063     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:30:58.063     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:30:58.063     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:30:58.063     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:30:58.138     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:31:06.252     INFO function=summary_emai L0109 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:31:07.046     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A31%3A06&stodate=2025-08-30+20%3A31%3A06 "HTTP/1.1 200 OK"
[2025-08-30T20:31:07.049     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59485 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:31:07.049     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59485 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:31:07.050    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 129, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:31:07.050    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 129, in summary_emails
    body = message.body.value
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'value'
[2025-08-30T20:35:06.155     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:35:06.156  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:35:06.156  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:35:06.207     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:35:06.207     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:35:06.312     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:35:06.312     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:35:06.313     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:35:06.313     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:35:06.313     INFO function=_serve       L0094 file=server.py   ] Finished server process [13060]
[2025-08-30T20:35:06.313     INFO function=_serve       L0094 file=server.py   ] Finished server process [13060]
[2025-08-30T20:35:11.167     INFO function=_serve       L0084 file=server.py   ] Started server process [12248]
[2025-08-30T20:35:11.167     INFO function=_serve       L0084 file=server.py   ] Started server process [12248]
[2025-08-30T20:35:11.168     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:35:11.168     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:35:11.168     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:35:11.168     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:35:11.222     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:35:17.680     INFO function=summary_emai L0109 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:35:18.385     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A35%3A17&stodate=2025-08-30+20%3A35%3A17 "HTTP/1.1 200 OK"
[2025-08-30T20:35:19.734     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:35:20.499     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:35:20.507    ERROR function=correct_json L0166 file=mail.py     ] Erreur de parsing JSON dans correct_json : 1 validation error for DailyResponse
emails.0
  Input should be a valid string [type=string_type, input_value={'subject': 'None'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
[2025-08-30T20:35:20.508     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51969 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:35:20.508     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51969 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:36:48.434     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:36:48.442  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T20:36:48.442  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T20:36:48.493     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:36:48.493     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:36:48.607     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:36:48.607     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:36:48.608     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:36:48.608     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:36:48.608     INFO function=_serve       L0094 file=server.py   ] Finished server process [12248]
[2025-08-30T20:36:48.608     INFO function=_serve       L0094 file=server.py   ] Finished server process [12248]
[2025-08-30T20:36:50.599     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:36:52.794     INFO function=_serve       L0084 file=server.py   ] Started server process [3936]
[2025-08-30T20:36:52.794     INFO function=_serve       L0084 file=server.py   ] Started server process [3936]
[2025-08-30T20:36:52.795     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:36:52.795     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:36:52.795     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:36:52.795     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:38:08.590     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:38:08.591  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:38:08.591  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:38:08.628     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:38:08.628     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:38:08.733     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:38:08.733     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:38:08.734     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:38:08.734     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:38:08.735     INFO function=_serve       L0094 file=server.py   ] Finished server process [3936]
[2025-08-30T20:38:08.735     INFO function=_serve       L0094 file=server.py   ] Finished server process [3936]
[2025-08-30T20:38:12.831  WARNING function=_load_descri L0026 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:38:12.838     INFO function=_serve       L0084 file=server.py   ] Started server process [12980]
[2025-08-30T20:38:12.838     INFO function=_serve       L0084 file=server.py   ] Started server process [12980]
[2025-08-30T20:38:12.839     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:38:12.839     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:38:12.840     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:38:12.840     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:38:12.891     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:38:17.144     INFO function=summary_emai L0119 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:38:17.862     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A38%3A17&stodate=2025-08-30+20%3A38%3A17 "HTTP/1.1 200 OK"
[2025-08-30T20:38:22.784     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:38:24.202     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:38:24.204     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65112 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:38:24.204     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65112 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:39:49.778     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:39:49.779  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:39:49.779  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:39:49.831     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:39:49.831     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:39:49.933     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:39:49.933     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:39:49.933     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:39:49.933     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:39:49.934     INFO function=_serve       L0094 file=server.py   ] Finished server process [12980]
[2025-08-30T20:39:49.934     INFO function=_serve       L0094 file=server.py   ] Finished server process [12980]
[2025-08-30T20:39:54.266  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:39:54.273     INFO function=_serve       L0084 file=server.py   ] Started server process [15060]
[2025-08-30T20:39:54.273     INFO function=_serve       L0084 file=server.py   ] Started server process [15060]
[2025-08-30T20:39:54.274     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:39:54.274     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:39:54.274     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:39:54.274     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:39:54.335     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:40:04.851     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:40:04.852  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T20:40:04.852  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T20:40:04.907     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:40:04.907     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:40:05.011     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:40:05.011     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:40:05.012     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:40:05.012     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:40:05.013     INFO function=_serve       L0094 file=server.py   ] Finished server process [15060]
[2025-08-30T20:40:05.013     INFO function=_serve       L0094 file=server.py   ] Finished server process [15060]
[2025-08-30T20:40:05.848     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:40:09.567  WARNING function=_load_descri L0027 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:40:09.574     INFO function=_serve       L0084 file=server.py   ] Started server process [9828]
[2025-08-30T20:40:09.574     INFO function=_serve       L0084 file=server.py   ] Started server process [9828]
[2025-08-30T20:40:09.575     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:40:09.575     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:40:09.576     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:40:09.576     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:41:13.683     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:41:13.683  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:41:13.683  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:41:13.764     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:41:13.764     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:41:13.866     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:41:13.866     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:41:13.867     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:41:13.867     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:41:13.867     INFO function=_serve       L0094 file=server.py   ] Finished server process [9828]
[2025-08-30T20:41:13.867     INFO function=_serve       L0094 file=server.py   ] Finished server process [9828]
[2025-08-30T20:41:18.301  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:41:18.308     INFO function=_serve       L0084 file=server.py   ] Started server process [10312]
[2025-08-30T20:41:18.308     INFO function=_serve       L0084 file=server.py   ] Started server process [10312]
[2025-08-30T20:41:18.309     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:41:18.309     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:41:18.310     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:41:18.310     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:41:18.363     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:41:28.879     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:41:28.880  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:41:28.880  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:41:28.965     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:41:28.965     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:41:29.080     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:41:29.080     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:41:29.080     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:41:29.080     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:41:29.081     INFO function=_serve       L0094 file=server.py   ] Finished server process [10312]
[2025-08-30T20:41:29.081     INFO function=_serve       L0094 file=server.py   ] Finished server process [10312]
[2025-08-30T20:41:33.205  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:41:33.212     INFO function=_serve       L0084 file=server.py   ] Started server process [5008]
[2025-08-30T20:41:33.212     INFO function=_serve       L0084 file=server.py   ] Started server process [5008]
[2025-08-30T20:41:33.213     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:41:33.213     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:41:33.214     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:41:33.214     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:41:33.254     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:41:36.186     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:41:36.912     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A41%3A36&stodate=2025-08-30+20%3A41%3A36 "HTTP/1.1 200 OK"
[2025-08-30T20:41:39.572     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:41:40.820     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:41:40.822    ERROR function=correct_json L0163 file=mail.py     ] Erreur de parsing JSON dans correct_json : 1 validation error for DailyResponse
emails.3
  Input should be a valid string [type=string_type, input_value={'key': 'no-reply@infoman....com', 'graymail': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
[2025-08-30T20:41:40.823     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60667 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:41:40.823     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60667 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:42:10.615     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:42:10.615  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:42:10.615  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:42:10.667     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:42:10.667     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:42:10.780     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:42:10.780     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:42:10.781     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:42:10.781     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:42:10.782     INFO function=_serve       L0094 file=server.py   ] Finished server process [5008]
[2025-08-30T20:42:10.782     INFO function=_serve       L0094 file=server.py   ] Finished server process [5008]
[2025-08-30T20:42:14.890  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:42:14.897     INFO function=_serve       L0084 file=server.py   ] Started server process [13536]
[2025-08-30T20:42:14.897     INFO function=_serve       L0084 file=server.py   ] Started server process [13536]
[2025-08-30T20:42:14.898     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:42:14.898     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:42:14.899     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:42:14.899     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:42:14.955     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:42:22.502     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:42:23.193     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A42%3A22&stodate=2025-08-30+20%3A42%3A22 "HTTP/1.1 200 OK"
[2025-08-30T20:42:27.217     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:42:29.504     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:42:29.507     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65056 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:42:29.507     INFO function=send         L0476 file=httptools_im] 127.0.0.1:65056 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:45:21.087     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:45:21.087  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:45:21.087  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:45:21.136     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:45:21.136     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:45:21.251     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:45:21.251     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:45:21.251     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:45:21.251     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:45:21.252     INFO function=_serve       L0094 file=server.py   ] Finished server process [13536]
[2025-08-30T20:45:21.252     INFO function=_serve       L0094 file=server.py   ] Finished server process [13536]
[2025-08-30T20:45:25.554  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:45:25.568     INFO function=_serve       L0084 file=server.py   ] Started server process [11820]
[2025-08-30T20:45:25.568     INFO function=_serve       L0084 file=server.py   ] Started server process [11820]
[2025-08-30T20:45:25.569     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:45:25.569     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:45:25.572     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:45:25.572     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:45:25.610     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:45:26.991     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:45:27.688     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A45%3A26&stodate=2025-08-30+20%3A45%3A26 "HTTP/1.1 200 OK"
[2025-08-30T20:45:28.921     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:45:29.403     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:45:29.406     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52240 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:45:29.406     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52240 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:45:48.029     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:45:48.031  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:45:48.031  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:45:48.034     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:45:48.034     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:45:48.151     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:45:48.151     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:45:48.153     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:45:48.153     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:45:48.153     INFO function=_serve       L0094 file=server.py   ] Finished server process [11820]
[2025-08-30T20:45:48.153     INFO function=_serve       L0094 file=server.py   ] Finished server process [11820]
[2025-08-30T20:45:52.506  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:45:52.513     INFO function=_serve       L0084 file=server.py   ] Started server process [12152]
[2025-08-30T20:45:52.513     INFO function=_serve       L0084 file=server.py   ] Started server process [12152]
[2025-08-30T20:45:52.514     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:45:52.514     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:45:52.515     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:45:52.515     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:45:52.599     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:45:55.154     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:45:55.835     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A45%3A55&stodate=2025-08-30+20%3A45%3A55 "HTTP/1.1 200 OK"
[2025-08-30T20:45:59.793     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:46:01.813     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:46:01.816     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52248 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:46:01.816     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52248 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:46:29.093     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:46:29.094  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:46:29.094  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:46:29.141     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:46:29.141     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:46:29.252     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:46:29.252     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:46:29.253     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:46:29.253     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:46:29.254     INFO function=_serve       L0094 file=server.py   ] Finished server process [12152]
[2025-08-30T20:46:29.254     INFO function=_serve       L0094 file=server.py   ] Finished server process [12152]
[2025-08-30T20:46:33.220  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:46:33.227     INFO function=_serve       L0084 file=server.py   ] Started server process [11104]
[2025-08-30T20:46:33.227     INFO function=_serve       L0084 file=server.py   ] Started server process [11104]
[2025-08-30T20:46:33.228     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:46:33.228     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:46:33.229     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:46:33.229     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:46:33.318     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:46:58.514     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:46:59.201     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A46%3A58&stodate=2025-08-30+20%3A46%3A58 "HTTP/1.1 200 OK"
[2025-08-30T20:46:59.204     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54565 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:46:59.204     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54565 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:46:59.205    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 146, in summary_emails
    text += f"From: {from_display}\nTo: {to_display}\nDate: {date}\nE-mail: {body}{email_sep}"
                                                             ^^^^
NameError: name 'date' is not defined
[2025-08-30T20:46:59.205    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 146, in summary_emails
    text += f"From: {from_display}\nTo: {to_display}\nDate: {date}\nE-mail: {body}{email_sep}"
                                                             ^^^^
NameError: name 'date' is not defined
[2025-08-30T20:47:48.716     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:47:48.717  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:47:48.717  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:47:48.805     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:47:48.805     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:47:48.907     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:47:48.907     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:47:48.907     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:47:48.907     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:47:48.908     INFO function=_serve       L0094 file=server.py   ] Finished server process [11104]
[2025-08-30T20:47:48.908     INFO function=_serve       L0094 file=server.py   ] Finished server process [11104]
[2025-08-30T20:47:53.553  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:47:53.560     INFO function=_serve       L0084 file=server.py   ] Started server process [12792]
[2025-08-30T20:47:53.560     INFO function=_serve       L0084 file=server.py   ] Started server process [12792]
[2025-08-30T20:47:53.561     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:47:53.561     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:47:53.562     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:47:53.562     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:47:53.616     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:47:53.632     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:47:54.262     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A47%3A53&stodate=2025-08-30+20%3A47%3A53 "HTTP/1.1 200 OK"
[2025-08-30T20:47:58.526     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:48:00.486     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:48:00.488     INFO function=send         L0476 file=httptools_im] 127.0.0.1:58342 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:48:00.488     INFO function=send         L0476 file=httptools_im] 127.0.0.1:58342 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:49:20.957     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:49:20.958  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:49:20.958  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:49:21.071     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:49:21.071     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:49:21.182     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:49:21.182     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:49:21.183     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:49:21.183     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:49:21.184     INFO function=_serve       L0094 file=server.py   ] Finished server process [12792]
[2025-08-30T20:49:21.184     INFO function=_serve       L0094 file=server.py   ] Finished server process [12792]
[2025-08-30T20:49:25.514  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:49:25.521     INFO function=_serve       L0084 file=server.py   ] Started server process [8972]
[2025-08-30T20:49:25.521     INFO function=_serve       L0084 file=server.py   ] Started server process [8972]
[2025-08-30T20:49:25.522     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:49:25.522     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:49:25.523     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:49:25.523     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:49:25.589     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:49:29.513     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:49:30.206     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A49%3A29&stodate=2025-08-30+20%3A49%3A29 "HTTP/1.1 200 OK"
[2025-08-30T20:49:36.129     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:49:44.074     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:49:44.077     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64268 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:49:44.077     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64268 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:51:08.248     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:51:08.249  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:51:08.249  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:51:08.307     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:51:08.307     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:51:08.408     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:51:08.408     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:51:08.409     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:51:08.409     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:51:08.409     INFO function=_serve       L0094 file=server.py   ] Finished server process [8972]
[2025-08-30T20:51:08.409     INFO function=_serve       L0094 file=server.py   ] Finished server process [8972]
[2025-08-30T20:51:12.849  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:51:12.856     INFO function=_serve       L0084 file=server.py   ] Started server process [14900]
[2025-08-30T20:51:12.856     INFO function=_serve       L0084 file=server.py   ] Started server process [14900]
[2025-08-30T20:51:12.857     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:51:12.857     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:51:12.858     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:51:12.858     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:51:12.917     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:51:43.648     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:51:44.444     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A51%3A43&stodate=2025-08-30+20%3A51%3A43 "HTTP/1.1 200 OK"
[2025-08-30T20:51:44.446     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60141 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:51:44.446     INFO function=send         L0476 file=httptools_im] 127.0.0.1:60141 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T20:51:44.447    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 147, in summary_emails
    ### E-mail du {date_str}
NameError: name 'date_str' is not defined
[2025-08-30T20:51:44.447    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 147, in summary_emails
    ### E-mail du {date_str}
NameError: name 'date_str' is not defined
[2025-08-30T20:52:20.273     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:52:20.273  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:52:20.273  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:52:20.363     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:52:20.363     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:52:20.475     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:52:20.475     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:52:20.476     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:52:20.476     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:52:20.477     INFO function=_serve       L0094 file=server.py   ] Finished server process [14900]
[2025-08-30T20:52:20.477     INFO function=_serve       L0094 file=server.py   ] Finished server process [14900]
[2025-08-30T20:52:24.787  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:52:24.794     INFO function=_serve       L0084 file=server.py   ] Started server process [8280]
[2025-08-30T20:52:24.794     INFO function=_serve       L0084 file=server.py   ] Started server process [8280]
[2025-08-30T20:52:24.795     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:52:24.795     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:52:24.796     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:52:24.796     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:52:24.845     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:52:24.886     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:52:25.608     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A52%3A24&stodate=2025-08-30+20%3A52%3A24 "HTTP/1.1 200 OK"
[2025-08-30T20:52:31.338     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:52:33.745     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:52:33.748     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63853 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:52:33.748     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63853 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:55:39.109     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:55:39.110  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:55:39.110  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:55:39.210     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:55:39.210     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:55:39.315     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:55:39.315     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:55:39.316     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:55:39.316     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:55:39.316     INFO function=_serve       L0094 file=server.py   ] Finished server process [8280]
[2025-08-30T20:55:39.316     INFO function=_serve       L0094 file=server.py   ] Finished server process [8280]
[2025-08-30T20:55:43.523  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:55:43.530     INFO function=_serve       L0084 file=server.py   ] Started server process [8560]
[2025-08-30T20:55:43.530     INFO function=_serve       L0084 file=server.py   ] Started server process [8560]
[2025-08-30T20:55:43.531     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:55:43.531     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:55:43.531     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:55:43.531     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:55:43.605     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:55:53.516     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:55:54.205     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A55%3A53&stodate=2025-08-30+20%3A55%3A53 "HTTP/1.1 200 OK"
[2025-08-30T20:55:58.345     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:55:59.936     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:55:59.938     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63041 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:55:59.938     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63041 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:56:30.729     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:56:30.730  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:56:30.730  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:56:30.813     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:56:30.813     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:56:30.927     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:56:30.927     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:56:30.928     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:56:30.928     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:56:30.929     INFO function=_serve       L0094 file=server.py   ] Finished server process [8560]
[2025-08-30T20:56:30.929     INFO function=_serve       L0094 file=server.py   ] Finished server process [8560]
[2025-08-30T20:56:35.282  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:56:35.289     INFO function=_serve       L0084 file=server.py   ] Started server process [14664]
[2025-08-30T20:56:35.289     INFO function=_serve       L0084 file=server.py   ] Started server process [14664]
[2025-08-30T20:56:35.290     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:56:35.290     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:56:35.291     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:56:35.291     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:56:35.338     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:56:37.095     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:56:37.855     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A56%3A37&stodate=2025-08-30+20%3A56%3A37 "HTTP/1.1 200 OK"
[2025-08-30T20:56:42.094     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:56:43.467     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:56:43.469     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62228 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:56:43.469     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62228 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:58:46.626     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T20:58:46.627  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:58:46.627  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T20:58:46.631     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:58:46.631     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T20:58:46.732     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:58:46.732     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T20:58:46.733     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:58:46.733     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T20:58:46.733     INFO function=_serve       L0094 file=server.py   ] Finished server process [14664]
[2025-08-30T20:58:46.733     INFO function=_serve       L0094 file=server.py   ] Finished server process [14664]
[2025-08-30T20:58:50.935  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T20:58:50.942     INFO function=_serve       L0084 file=server.py   ] Started server process [7848]
[2025-08-30T20:58:50.942     INFO function=_serve       L0084 file=server.py   ] Started server process [7848]
[2025-08-30T20:58:50.943     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:58:50.943     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T20:58:50.944     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:58:50.944     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T20:58:51.026     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T20:58:54.459     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T20:58:55.150     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+20%3A58%3A54&stodate=2025-08-30+20%3A58%3A54 "HTTP/1.1 200 OK"
[2025-08-30T20:58:57.903     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:58:58.943     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T20:58:58.946     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50279 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T20:58:58.946     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50279 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:04:25.533     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:04:25.534  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:04:25.534  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:04:25.572     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:04:25.572     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:04:25.687     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:04:25.687     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:04:25.688     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:04:25.688     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:04:25.688     INFO function=_serve       L0094 file=server.py   ] Finished server process [7848]
[2025-08-30T21:04:25.688     INFO function=_serve       L0094 file=server.py   ] Finished server process [7848]
[2025-08-30T21:04:29.803  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:04:29.810     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T21:04:29.810     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T21:04:29.811     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:04:29.811     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:04:29.812     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:04:29.812     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:04:29.867     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:04:34.256     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:04:34.988     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A04%3A34&stodate=2025-08-30+21%3A04%3A34 "HTTP/1.1 200 OK"
[2025-08-30T21:04:35.514     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 422 Unprocessable Content"
[2025-08-30T21:04:35.516     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50197 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:04:35.516     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50197 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:04:35.517    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 155, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.UnprocessableEntityError: Error code: 422 - {'result': 'error', 'error': {'code': 'validation_failed', 'description': 'Validation failed', 'errors': [{'code': 'validation_rule_in', 'description': 'The selected model is invalid.', 'context': {'attribute': 'model', 'values': ['mistral3', 'qwen3', 'gemma3n']}}]}}
[2025-08-30T21:04:35.517    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 155, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1151, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        **payload
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 183, in parse
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<49 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.UnprocessableEntityError: Error code: 422 - {'result': 'error', 'error': {'code': 'validation_failed', 'description': 'Validation failed', 'errors': [{'code': 'validation_rule_in', 'description': 'The selected model is invalid.', 'context': {'attribute': 'model', 'values': ['mistral3', 'qwen3', 'gemma3n']}}]}}
[2025-08-30T21:06:21.812     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:06:21.813  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:06:21.813  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:06:21.889     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:06:21.889     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:06:22.004     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:06:22.004     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:06:22.005     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:06:22.005     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:06:22.006     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T21:06:22.006     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T21:06:26.859  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:06:26.867     INFO function=_serve       L0084 file=server.py   ] Started server process [8616]
[2025-08-30T21:06:26.867     INFO function=_serve       L0084 file=server.py   ] Started server process [8616]
[2025-08-30T21:06:26.868     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:06:26.868     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:06:26.869     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:06:26.869     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:06:26.933     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:09:37.126     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:09:37.127  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:09:37.127  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:09:37.179     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:09:37.179     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:09:37.290     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:09:37.290     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:09:37.291     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:09:37.291     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:09:37.291     INFO function=_serve       L0094 file=server.py   ] Finished server process [8616]
[2025-08-30T21:09:37.291     INFO function=_serve       L0094 file=server.py   ] Finished server process [8616]
[2025-08-30T21:09:41.313  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:09:41.411     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:10:13.864     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:10:13.865  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:10:13.865  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:10:17.093     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:10:17.093  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:10:17.093  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:10:17.746  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:10:18.461     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:10:21.931  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:11:43.953     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:11:43.954  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:11:43.954  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:11:47.715  WARNING function=_load_descri L0026 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:11:47.721     INFO function=_serve       L0084 file=server.py   ] Started server process [13040]
[2025-08-30T21:11:47.721     INFO function=_serve       L0084 file=server.py   ] Started server process [13040]
[2025-08-30T21:11:47.722     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:11:47.722     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:11:47.723     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:11:47.723     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:11:47.786     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:11:51.676     INFO function=summary_emai L0153 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:11:52.358     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A11%3A51&stodate=2025-08-30+21%3A11%3A51 "HTTP/1.1 200 OK"
[2025-08-30T21:11:52.360     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62077 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:11:52.360     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62077 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:11:52.361    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 176, in summary_emails
    if chunk:
       ^^^^^
NameError: name 'chunk' is not defined
[2025-08-30T21:11:52.361    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 176, in summary_emails
    if chunk:
       ^^^^^
NameError: name 'chunk' is not defined
[2025-08-30T21:12:28.065     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:12:28.066  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:12:28.066  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:12:28.079     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:12:28.079     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:12:28.184     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:12:28.184     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:12:28.185     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:12:28.185     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:12:28.185     INFO function=_serve       L0094 file=server.py   ] Finished server process [13040]
[2025-08-30T21:12:28.185     INFO function=_serve       L0094 file=server.py   ] Finished server process [13040]
[2025-08-30T21:12:32.450  WARNING function=_load_descri L0026 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:12:32.456     INFO function=_serve       L0084 file=server.py   ] Started server process [12488]
[2025-08-30T21:12:32.456     INFO function=_serve       L0084 file=server.py   ] Started server process [12488]
[2025-08-30T21:12:32.458     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:12:32.458     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:12:32.458     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:12:32.458     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:12:32.513     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:12:34.529     INFO function=summary_emai L0153 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:12:35.432     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A12%3A34&stodate=2025-08-30+21%3A12%3A34 "HTTP/1.1 200 OK"
[2025-08-30T21:12:35.439     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50840 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:12:35.439     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50840 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:12:35.440    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 185, in summary_emails
    parsed_emails = extract_unique_emails(body)
                                          ^^^^
NameError: name 'body' is not defined
[2025-08-30T21:12:35.440    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 185, in summary_emails
    parsed_emails = extract_unique_emails(body)
                                          ^^^^
NameError: name 'body' is not defined
[2025-08-30T21:13:21.863     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:13:21.864  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:13:21.864  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:13:21.947     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:13:21.947     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:13:22.063     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:13:22.063     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:13:22.064     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:13:22.064     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:13:22.064     INFO function=_serve       L0094 file=server.py   ] Finished server process [12488]
[2025-08-30T21:13:22.064     INFO function=_serve       L0094 file=server.py   ] Finished server process [12488]
[2025-08-30T21:13:26.277  WARNING function=_load_descri L0026 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:13:26.284     INFO function=_serve       L0084 file=server.py   ] Started server process [11352]
[2025-08-30T21:13:26.284     INFO function=_serve       L0084 file=server.py   ] Started server process [11352]
[2025-08-30T21:13:26.285     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:13:26.285     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:13:26.286     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:13:26.286     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:13:26.336     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:13:28.226     INFO function=summary_emai L0153 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:13:28.933     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A13%3A28&stodate=2025-08-30+21%3A13%3A28 "HTTP/1.1 200 OK"
[2025-08-30T21:13:28.936     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52937 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:13:28.936     INFO function=send         L0476 file=httptools_im] 127.0.0.1:52937 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:13:28.937    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 185, in summary_emails
    parsed_emails = extract_unique_emails(email_chunks)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 66, in extract_unique_emails
    return list(set(re.findall(basic_email_pattern, text)))
                    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\re\__init__.py", line 278, in findall
    return _compile(pattern, flags).findall(string)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
TypeError: expected string or bytes-like object, got 'list'
[2025-08-30T21:13:28.937    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 185, in summary_emails
    parsed_emails = extract_unique_emails(email_chunks)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 66, in extract_unique_emails
    return list(set(re.findall(basic_email_pattern, text)))
                    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\re\__init__.py", line 278, in findall
    return _compile(pattern, flags).findall(string)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
TypeError: expected string or bytes-like object, got 'list'
[2025-08-30T21:15:22.448     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:15:22.449  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:15:22.449  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:15:22.532     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:15:22.532     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:15:22.636     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:15:22.636     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:15:22.636     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:15:22.636     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:15:22.637     INFO function=_serve       L0094 file=server.py   ] Finished server process [11352]
[2025-08-30T21:15:22.637     INFO function=_serve       L0094 file=server.py   ] Finished server process [11352]
[2025-08-30T21:15:26.814     INFO function=_serve       L0084 file=server.py   ] Started server process [6668]
[2025-08-30T21:15:26.814     INFO function=_serve       L0084 file=server.py   ] Started server process [6668]
[2025-08-30T21:15:26.815     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:15:26.815     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:15:26.816     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:15:26.816     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:15:26.882     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:15:30.725     INFO function=summary_emai L0102 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:15:31.440     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A15%3A30&stodate=2025-08-30+21%3A15%3A30 "HTTP/1.1 200 OK"
[2025-08-30T21:15:35.317     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:15:36.496     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:15:36.500     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49846 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:15:36.500     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49846 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:15:57.738     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:15:57.739  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:15:57.739  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:15:57.816     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:15:57.816     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:15:57.933     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:15:57.933     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:15:57.934     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:15:57.934     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:15:57.935     INFO function=_serve       L0094 file=server.py   ] Finished server process [6668]
[2025-08-30T21:15:57.935     INFO function=_serve       L0094 file=server.py   ] Finished server process [6668]
[2025-08-30T21:16:02.031  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:16:02.037     INFO function=_serve       L0084 file=server.py   ] Started server process [13616]
[2025-08-30T21:16:02.037     INFO function=_serve       L0084 file=server.py   ] Started server process [13616]
[2025-08-30T21:16:02.038     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:02.038     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:02.039     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:02.039     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:02.086     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:16:12.397     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:16:13.110     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A16%3A12&stodate=2025-08-30+21%3A16%3A12 "HTTP/1.1 200 OK"
[2025-08-30T21:16:15.850     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:16:17.131     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:16:17.134     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49854 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:16:17.134     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49854 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:16:25.739     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:16:25.740  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:16:25.740  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:16:25.784     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:16:25.784     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:16:25.899     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:16:25.899     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:16:25.900     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:16:25.900     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:16:25.901     INFO function=_serve       L0094 file=server.py   ] Finished server process [13616]
[2025-08-30T21:16:25.901     INFO function=_serve       L0094 file=server.py   ] Finished server process [13616]
[2025-08-30T21:16:30.049  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:16:30.055     INFO function=_serve       L0084 file=server.py   ] Started server process [8308]
[2025-08-30T21:16:30.055     INFO function=_serve       L0084 file=server.py   ] Started server process [8308]
[2025-08-30T21:16:30.056     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:30.056     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:30.057     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:30.057     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:30.101     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:16:45.094     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:16:45.095  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:16:45.095  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:16:45.169     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:16:45.169     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:16:45.283     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:16:45.283     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:16:45.284     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:16:45.284     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:16:45.284     INFO function=_serve       L0094 file=server.py   ] Finished server process [8308]
[2025-08-30T21:16:45.284     INFO function=_serve       L0094 file=server.py   ] Finished server process [8308]
[2025-08-30T21:16:49.426  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:16:49.434     INFO function=_serve       L0084 file=server.py   ] Started server process [8616]
[2025-08-30T21:16:49.434     INFO function=_serve       L0084 file=server.py   ] Started server process [8616]
[2025-08-30T21:16:49.435     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:49.435     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:16:49.436     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:49.436     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:16:49.484     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:16:53.933     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:16:54.657     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A16%3A53&stodate=2025-08-30+21%3A16%3A53 "HTTP/1.1 200 OK"
[2025-08-30T21:16:56.959     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:16:59.212     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:16:59.220    ERROR function=correct_json L0163 file=mail.py     ] Erreur de parsing JSON dans correct_json : 2 validation errors for DailyResponse
meeting_suggestions.0
  Input should be a valid string [type=string_type, input_value={'attendees': ['timothee....], 'date': '2025-08-30'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
meeting_suggestions.1
  Input should be a valid string [type=string_type, input_value={'attendees': ['sylvie.fo...], 'date': '2025-08-29'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
[2025-08-30T21:16:59.221     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59208 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:16:59.221     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59208 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:17:43.582     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:17:43.583  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T21:17:43.583  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T21:17:43.620     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:17:43.620     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:17:43.721     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:17:43.721     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:17:43.722     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:17:43.722     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:17:43.723     INFO function=_serve       L0094 file=server.py   ] Finished server process [8616]
[2025-08-30T21:17:43.723     INFO function=_serve       L0094 file=server.py   ] Finished server process [8616]
[2025-08-30T21:17:45.165     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:17:48.656  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:17:48.662     INFO function=_serve       L0084 file=server.py   ] Started server process [6708]
[2025-08-30T21:17:48.662     INFO function=_serve       L0084 file=server.py   ] Started server process [6708]
[2025-08-30T21:17:48.663     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:17:48.663     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:17:48.664     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:17:48.664     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:19:17.885     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:19:17.886  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:19:17.886  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:19:17.986     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:19:17.986     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:19:18.104     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:19:18.104     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:19:18.105     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:19:18.105     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:19:18.106     INFO function=_serve       L0094 file=server.py   ] Finished server process [6708]
[2025-08-30T21:19:18.106     INFO function=_serve       L0094 file=server.py   ] Finished server process [6708]
[2025-08-30T21:19:22.345  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:19:22.351     INFO function=_serve       L0084 file=server.py   ] Started server process [14600]
[2025-08-30T21:19:22.351     INFO function=_serve       L0084 file=server.py   ] Started server process [14600]
[2025-08-30T21:19:22.352     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:19:22.352     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:19:22.353     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:19:22.353     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:19:22.429     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:19:32.434     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:19:33.135     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A19%3A32&stodate=2025-08-30+21%3A19%3A32 "HTTP/1.1 200 OK"
[2025-08-30T21:19:35.587     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:19:36.785     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:19:36.788     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59952 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:19:36.788     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59952 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:22:29.664     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:22:29.665  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:22:29.665  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:22:29.710     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:22:29.710     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:22:29.819     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:22:29.819     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:22:29.820     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:22:29.820     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:22:29.820     INFO function=_serve       L0094 file=server.py   ] Finished server process [14600]
[2025-08-30T21:22:29.820     INFO function=_serve       L0094 file=server.py   ] Finished server process [14600]
[2025-08-30T21:22:34.430  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:22:34.437     INFO function=_serve       L0084 file=server.py   ] Started server process [8564]
[2025-08-30T21:22:34.437     INFO function=_serve       L0084 file=server.py   ] Started server process [8564]
[2025-08-30T21:22:34.439     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:22:34.439     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:22:34.440     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:22:34.440     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:22:34.517     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:22:37.293     INFO function=summary_emai L0118 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:22:37.986     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A22%3A37&stodate=2025-08-30+21%3A22%3A37 "HTTP/1.1 200 OK"
[2025-08-30T21:22:40.632     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:22:41.809     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:22:41.811     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64532 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:22:41.811     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64532 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:24:56.150     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:24:56.151  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:24:56.151  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:24:56.177     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:24:56.177     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:24:56.290     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:24:56.290     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:24:56.294     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:24:56.294     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:24:56.294     INFO function=_serve       L0094 file=server.py   ] Finished server process [8564]
[2025-08-30T21:24:56.294     INFO function=_serve       L0094 file=server.py   ] Finished server process [8564]
[2025-08-30T21:24:58.470     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:25:00.702  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:25:00.709     INFO function=_serve       L0084 file=server.py   ] Started server process [15296]
[2025-08-30T21:25:00.709     INFO function=_serve       L0084 file=server.py   ] Started server process [15296]
[2025-08-30T21:25:00.710     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:25:00.710     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:25:00.711     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:25:00.711     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:25:08.140     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:25:08.141  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:25:08.141  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:25:08.211     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:25:08.211     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:25:08.312     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:25:08.312     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:25:08.313     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:25:08.313     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:25:08.313     INFO function=_serve       L0094 file=server.py   ] Finished server process [15296]
[2025-08-30T21:25:08.313     INFO function=_serve       L0094 file=server.py   ] Finished server process [15296]
[2025-08-30T21:25:10.554     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:25:12.649  WARNING function=_load_descri L0025 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:25:12.655     INFO function=_serve       L0084 file=server.py   ] Started server process [12400]
[2025-08-30T21:25:12.655     INFO function=_serve       L0084 file=server.py   ] Started server process [12400]
[2025-08-30T21:25:12.657     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:25:12.657     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:25:12.657     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:25:12.657     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:26:58.525     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:26:58.525  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:26:58.525  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:26:58.527     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:26:58.527     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:26:58.629     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:26:58.629     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:26:58.630     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:26:58.630     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:26:58.631     INFO function=_serve       L0094 file=server.py   ] Finished server process [12400]
[2025-08-30T21:26:58.631     INFO function=_serve       L0094 file=server.py   ] Finished server process [12400]
[2025-08-30T21:27:03.023  WARNING function=_load_descri L0023 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:27:03.029     INFO function=_serve       L0084 file=server.py   ] Started server process [2080]
[2025-08-30T21:27:03.029     INFO function=_serve       L0084 file=server.py   ] Started server process [2080]
[2025-08-30T21:27:03.030     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:27:03.030     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:27:03.031     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:27:03.031     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:27:03.116     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:27:03.431     INFO function=summary_emai L0116 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:27:04.215     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A27%3A03&stodate=2025-08-30+21%3A27%3A03 "HTTP/1.1 200 OK"
[2025-08-30T21:27:07.215     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:27:07.824     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:27:07.827     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51078 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:27:07.827     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51078 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:27:31.008     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:27:31.009  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:27:31.009  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:27:31.027     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:27:31.027     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:27:31.133     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:27:31.133     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:27:31.133     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:27:31.133     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:27:31.134     INFO function=_serve       L0094 file=server.py   ] Finished server process [2080]
[2025-08-30T21:27:31.134     INFO function=_serve       L0094 file=server.py   ] Finished server process [2080]
[2025-08-30T21:27:35.503  WARNING function=_load_descri L0023 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:27:35.510     INFO function=_serve       L0084 file=server.py   ] Started server process [14316]
[2025-08-30T21:27:35.510     INFO function=_serve       L0084 file=server.py   ] Started server process [14316]
[2025-08-30T21:27:35.511     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:27:35.511     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:27:35.512     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:27:35.512     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:27:35.599     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:27:38.595     INFO function=summary_emai L0116 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:27:39.313     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A27%3A38&stodate=2025-08-30+21%3A27%3A38 "HTTP/1.1 200 OK"
[2025-08-30T21:27:42.721     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:27:44.004     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:27:44.005     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62355 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:27:44.005     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62355 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:28:12.891     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:28:12.892  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:28:12.892  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:28:12.929     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:28:12.929     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:28:13.031     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:28:13.031     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:28:13.031     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:28:13.031     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:28:13.032     INFO function=_serve       L0094 file=server.py   ] Finished server process [14316]
[2025-08-30T21:28:13.032     INFO function=_serve       L0094 file=server.py   ] Finished server process [14316]
[2025-08-30T21:28:15.073     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:28:17.311  WARNING function=_load_descri L0023 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:28:17.320     INFO function=_serve       L0084 file=server.py   ] Started server process [12284]
[2025-08-30T21:28:17.320     INFO function=_serve       L0084 file=server.py   ] Started server process [12284]
[2025-08-30T21:28:17.321     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:28:17.321     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:28:17.321     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:28:17.321     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:28:32.217     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:28:32.218  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:28:32.218  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:28:32.246     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:28:32.246     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:28:32.362     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:28:32.362     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:28:32.363     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:28:32.363     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:28:32.364     INFO function=_serve       L0094 file=server.py   ] Finished server process [12284]
[2025-08-30T21:28:32.364     INFO function=_serve       L0094 file=server.py   ] Finished server process [12284]
[2025-08-30T21:28:36.573  WARNING function=_load_descri L0023 file=daily.py    ] Documentation manquante : C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\common\docs\summary_emails.md
[2025-08-30T21:28:36.580     INFO function=_serve       L0084 file=server.py   ] Started server process [13192]
[2025-08-30T21:28:36.580     INFO function=_serve       L0084 file=server.py   ] Started server process [13192]
[2025-08-30T21:28:36.581     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:28:36.581     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:28:36.582     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:28:36.582     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:28:36.661     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:28:41.820     INFO function=summary_emai L0116 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:28:42.517     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A28%3A41&stodate=2025-08-30+21%3A28%3A41 "HTTP/1.1 200 OK"
[2025-08-30T21:28:45.445     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:28:46.360     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:28:46.363     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55853 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:28:46.363     INFO function=send         L0476 file=httptools_im] 127.0.0.1:55853 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:29:26.972     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:29:26.973  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:29:26.973  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:29:27.013     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:29:27.013     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:29:27.129     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:29:27.129     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:29:27.130     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:29:27.130     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:29:27.131     INFO function=_serve       L0094 file=server.py   ] Finished server process [13192]
[2025-08-30T21:29:27.131     INFO function=_serve       L0094 file=server.py   ] Finished server process [13192]
[2025-08-30T21:29:31.432     INFO function=_serve       L0084 file=server.py   ] Started server process [13848]
[2025-08-30T21:29:31.432     INFO function=_serve       L0084 file=server.py   ] Started server process [13848]
[2025-08-30T21:29:31.433     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:29:31.433     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:29:31.434     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:29:31.434     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:29:31.479     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:30:21.494     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:30:22.150     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A30%3A21&stodate=2025-08-30+21%3A30%3A21 "HTTP/1.1 200 OK"
[2025-08-30T21:30:26.195     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:30:27.230     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:30:27.232     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59790 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:30:27.232     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59790 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:36:07.527     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:36:07.528  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:36:07.528  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:36:07.536     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:36:07.536     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:36:07.637     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:36:07.637     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:36:07.638     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:36:07.638     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:36:07.639     INFO function=_serve       L0094 file=server.py   ] Finished server process [13848]
[2025-08-30T21:36:07.639     INFO function=_serve       L0094 file=server.py   ] Finished server process [13848]
[2025-08-30T21:36:12.024     INFO function=_serve       L0084 file=server.py   ] Started server process [14496]
[2025-08-30T21:36:12.024     INFO function=_serve       L0084 file=server.py   ] Started server process [14496]
[2025-08-30T21:36:12.025     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:36:12.025     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:36:12.026     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:36:12.026     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:36:12.076     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:36:17.988     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:36:18.723     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A36%3A17&stodate=2025-08-30+21%3A36%3A17 "HTTP/1.1 200 OK"
[2025-08-30T21:36:18.733     INFO function=summary_emai L0112 file=daily.py    ] Nombre de threads rcuprs : 7
[2025-08-30T21:36:22.106     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:36:23.579     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:36:23.581    ERROR function=correct_json L0163 file=mail.py     ] Erreur de parsing JSON dans correct_json : Extra data: line 1 column 9 (char 8)
[2025-08-30T21:36:23.582     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61561 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:36:23.582     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61561 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:39:53.031     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:39:53.032  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:39:53.032  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T21:39:53.091     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:39:53.091     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:39:53.195     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:39:53.195     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:39:53.196     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:39:53.196     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:39:53.197     INFO function=_serve       L0094 file=server.py   ] Finished server process [14496]
[2025-08-30T21:39:53.197     INFO function=_serve       L0094 file=server.py   ] Finished server process [14496]
[2025-08-30T21:39:55.429     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:39:57.582     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T21:39:57.582     INFO function=_serve       L0084 file=server.py   ] Started server process [6728]
[2025-08-30T21:39:57.583     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:39:57.583     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:39:57.583     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:39:57.583     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:40:01.945     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:40:02.739     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A40%3A01&stodate=2025-08-30+21%3A40%3A01 "HTTP/1.1 200 OK"
[2025-08-30T21:40:02.743     INFO function=summary_emai L0112 file=daily.py    ] Nombre de threads rcuprs : 7
[2025-08-30T21:40:05.728     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:40:06.681     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:40:06.682     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61925 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:40:06.682     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61925 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:41:51.816     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:41:51.817  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:41:51.817  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:41:51.824     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:41:51.824     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:41:51.927     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:41:51.927     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:41:51.928     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:41:51.928     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:41:51.928     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T21:41:51.928     INFO function=_serve       L0094 file=server.py   ] Finished server process [6728]
[2025-08-30T21:41:56.054     INFO function=_serve       L0084 file=server.py   ] Started server process [11412]
[2025-08-30T21:41:56.054     INFO function=_serve       L0084 file=server.py   ] Started server process [11412]
[2025-08-30T21:41:56.055     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:41:56.055     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:41:56.056     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:41:56.056     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:41:56.131     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:42:03.406     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:42:04.147     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A42%3A03&stodate=2025-08-30+21%3A42%3A03 "HTTP/1.1 200 OK"
[2025-08-30T21:42:04.158     INFO function=summary_emai L0114 file=daily.py    ] message : uid='9@eJzz9HPyjwAABGYBgQ--' msg_id='2b880139-3e7e-4435-ab50-d7d0633b8c28@mail.infomaniak.com' date=datetime.datetime(2025, 8, 30, 21, 22, 14, tzinfo=TzInfo(+02:00)) subject='meq' from_=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/9' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/9/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview="Salut, j'aimerai bien prendre un rendez-vous. merci" body=None
[2025-08-30T21:42:04.159     INFO function=summary_emai L0114 file=daily.py    ] message : uid='8@eJzz9HPyjwAABGYBgQ--' msg_id='b2a8c197-c595-4b50-85fc-9adbbdb1eb9d@mail.infomaniak.com' date=datetime.datetime(2025, 8, 30, 17, 59, 15, tzinfo=TzInfo(+02:00)) subject='Organisation rdv' from_=[EmailAddress(email='timothee.frily2@hackaton.ch', name='')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/8' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/8/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview="Bonjour Loic, Contact moi pour qu'on organise notre escapade au antilles. Passe une bonne journer Cordialement, Timothee Frily" body=None
[2025-08-30T21:42:04.160     INFO function=summary_emai L0114 file=daily.py    ] message : uid='7@eJzz9HPyjwAABGYBgQ--' msg_id='6RvfEtJ80MWfH4nXVTQuNwuju5xJWwVU6SAuakyfmqw@api-notify-worker-automail-5578565c5b-wjs9x' date=datetime.datetime(2025, 8, 30, 12, 0, 37, tzinfo=TzInfo(+02:00)) subject='Exploitez la puissance de kDrive' from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/7' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/7/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview='Exploitez la puissance de kDrive Infomaniak \xa0 [IMG:1797827-hackaton.ch]Infomaniak ** Drive ** \xa0 *Exploitez la puissance de kDrive* Bonjour Loc Gosselke, Voici des ressources qui vous aideront  plein' body=None
[2025-08-30T21:42:04.160     INFO function=summary_emai L0114 file=daily.py    ] message : uid='6@eJzz9HPyjwAABGYBgQ--' msg_id='381460b03415015d38883a59363cf47e@infomaniak.com' date=datetime.datetime(2025, 8, 30, 8, 12, 40, tzinfo=TzInfo(+02:00)) subject='Vous avez 1 message non lu dans hackaton.ch' from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/6' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/6/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview='Infomaniak kChat Infomaniak \xa0 \xa0 Vous avez 1 message non lu dans hackaton.ch Ouvrir kChat 1 message dans vos conversations directes sylvie.forster vendredi 29 aot 2025 17:13 1 nouveau message Mettez ' body=None
[2025-08-30T21:42:04.161     INFO function=summary_emai L0114 file=daily.py    ] message : uid='5@eJzz9HPyjwAABGYBgQ--' msg_id='257be70c-b118-400e-9f2d-28c9558a921d@mail.infomaniak.com' date=datetime.datetime(2025, 8, 29, 18, 5, 41, tzinfo=TzInfo(+02:00)) subject='Mon anni' from_=[EmailAddress(email='sylvie.forster@hackaton.ch', name='')] to=[EmailAddress(email='mug4z@protonmail.com', name='Timothe Frily'), EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/5/download' has_attachments=False seen=True forwarded=False answered=True flagged=False preview='Hello! Peux-tu venir  mon anni le 13 septembre  8h30? Nous allons pcher le silure. A bientot Sylvie' body=None
[2025-08-30T21:42:04.162     INFO function=summary_emai L0114 file=daily.py    ] message : uid='4@eJzz9HPyjwAABGYBgQ--' msg_id='begJdqUU0JiUMOxGPv5vjor59rD5WTS17mMwB3Hz8ZU@api-notify-worker-automail-78c4c94cd8-xdsj7' date=datetime.datetime(2025, 8, 29, 12, 0, 38, tzinfo=TzInfo(+02:00)) subject='Installez kDrive sur vos appareils' from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/4' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/4/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview='Installez kDrive sur vos appareils Infomaniak \xa0 [IMG:1797827-hackaton.ch]Infomaniak ** Drive ** \xa0 [endif]--> *Installez kDrive sur vos appareils* [endif]--> [endif]--> [ LINK: https://kdrive.infomania' body=None
[2025-08-30T21:42:04.163     INFO function=summary_emai L0114 file=daily.py    ] message : uid='3@eJzz9HPyjwAABGYBgQ--' msg_id='9d34e26b033caec78567a1afb2cd4078@infomaniak.com' date=datetime.datetime(2025, 8, 29, 8, 13, 17, tzinfo=TzInfo(+02:00)) subject='Vous avez 1 message non lu dans hackaton.ch' from_=[EmailAddress(email='no-reply@infomaniak.com', name='Infomaniak')] to=[EmailAddress(email='loic.gosselke@hackaton.ch', name='Loc Gosselke')] cc=[] bcc=[] priority='normal' resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3' download_resource='/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message/3/download' has_attachments=False seen=True forwarded=False answered=False flagged=False preview='Infomaniak kChat Infomaniak \xa0 \xa0 Vous avez 1 message non lu dans hackaton.ch Ouvrir kChat 1 message dans vos conversations directes euria jeudi 28 aot 2025 20:24 1 nouveau message Mettez  jour vos pa' body=None
[2025-08-30T21:42:08.086     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:42:17.023     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T21:42:17.026    ERROR function=correct_json L0176 file=mail.py     ] Erreur de validation Pydantic dans correct_json : 1 validation error for DailyResponse
title
  String should have at least 5 characters [type=string_too_short, input_value='meq', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/string_too_short
[2025-08-30T21:42:17.027     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61971 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:42:17.027     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61971 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:50:47.693     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:50:47.694  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:50:47.694  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:50:47.735     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:50:47.735     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:50:47.838     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:50:47.838     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:50:47.839     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:50:47.839     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:50:47.840     INFO function=_serve       L0094 file=server.py   ] Finished server process [11412]
[2025-08-30T21:50:47.840     INFO function=_serve       L0094 file=server.py   ] Finished server process [11412]
[2025-08-30T21:50:52.045     INFO function=_serve       L0084 file=server.py   ] Started server process [6312]
[2025-08-30T21:50:52.045     INFO function=_serve       L0084 file=server.py   ] Started server process [6312]
[2025-08-30T21:50:52.046     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:50:52.046     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:50:52.047     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:50:52.047     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:50:52.126     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:50:59.198     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:50:59.988     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A50%3A59&stodate=2025-08-30+21%3A50%3A59 "HTTP/1.1 200 OK"
[2025-08-30T21:50:59.998     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51842 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:50:59.998     INFO function=send         L0476 file=httptools_im] 127.0.0.1:51842 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:50:59.999    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 123, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                               ^^^^^^^^
NameError: name 'get_mail' is not defined
[2025-08-30T21:50:59.999    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 123, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                               ^^^^^^^^
NameError: name 'get_mail' is not defined
[2025-08-30T21:51:15.881     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:51:15.881  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:51:15.881  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:51:15.902     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:51:15.902     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:51:16.009     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:51:16.009     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:51:16.010     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:51:16.010     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:51:16.010     INFO function=_serve       L0094 file=server.py   ] Finished server process [6312]
[2025-08-30T21:51:16.010     INFO function=_serve       L0094 file=server.py   ] Finished server process [6312]
[2025-08-30T21:51:20.163     INFO function=_serve       L0084 file=server.py   ] Started server process [12116]
[2025-08-30T21:51:20.163     INFO function=_serve       L0084 file=server.py   ] Started server process [12116]
[2025-08-30T21:51:20.164     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:51:20.164     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:51:20.165     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:51:20.165     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:51:20.206     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:51:23.609     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:51:24.327     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A51%3A23&stodate=2025-08-30+21%3A51%3A23 "HTTP/1.1 200 OK"
[2025-08-30T21:51:24.338     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50377 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:51:24.338     INFO function=send         L0476 file=httptools_im] 127.0.0.1:50377 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:51:24.339    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 123, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 47, in get_mail
    tasks = [fetch_mail(*msg_uid.split("@")) for msg_uid in context_message_uid if "@" in msg_uid]
             ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:51:24.339    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 123, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 47, in get_mail
    tasks = [fetch_mail(*msg_uid.split("@")) for msg_uid in context_message_uid if "@" in msg_uid]
             ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:56:01.583     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:56:01.584  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:56:01.584  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:56:01.641     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:56:01.641     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:56:01.755     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:56:01.755     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:56:01.756     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:56:01.756     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:56:01.757     INFO function=_serve       L0094 file=server.py   ] Finished server process [12116]
[2025-08-30T21:56:01.757     INFO function=_serve       L0094 file=server.py   ] Finished server process [12116]
[2025-08-30T21:56:25.073     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:56:25.075  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:56:25.075  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:57:00.026     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:57:00.026  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:57:00.026  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:57:03.754     INFO function=_serve       L0084 file=server.py   ] Started server process [2616]
[2025-08-30T21:57:03.754     INFO function=_serve       L0084 file=server.py   ] Started server process [2616]
[2025-08-30T21:57:03.755     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:57:03.755     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:57:03.756     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:57:03.756     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:57:03.807     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:57:08.553     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:57:09.306     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A57%3A08&stodate=2025-08-30+21%3A57%3A08 "HTTP/1.1 200 OK"
[2025-08-30T21:57:09.350     INFO function=summary_emai L0127 file=daily.py    ] Chargement du corps de 7 message(s)...
[2025-08-30T21:57:09.351    ERROR function=summary_emai L0133 file=daily.py    ] chec de get_mail: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:57:09.351     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54999 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:57:09.351     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54999 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:57:09.351    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 131, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 47, in get_mail
    tasks = [fetch_mail(*msg_uid.split("@")) for msg_uid in context_message_uid if "@" in msg_uid]
             ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 134, in summary_emails
    raise HTTPException(status_code=500, detail="Erreur lors du chargement des contenus")
          ^^^^^^^^^^^^^
NameError: name 'HTTPException' is not defined. Did you mean: 'BaseException'?
[2025-08-30T21:57:09.351    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 131, in summary_emails
    detailed_responses = await get_mail(message_uids, ik_api, mailbox_id)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\common\mail_utils.py", line 47, in get_mail
    tasks = [fetch_mail(*msg_uid.split("@")) for msg_uid in context_message_uid if "@" in msg_uid]
             ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
TypeError: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 134, in summary_emails
    raise HTTPException(status_code=500, detail="Erreur lors du chargement des contenus")
          ^^^^^^^^^^^^^
NameError: name 'HTTPException' is not defined. Did you mean: 'BaseException'?
[2025-08-30T21:57:34.430     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:57:34.431  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:57:34.431  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:57:34.492     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:57:34.492     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:57:34.594     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:57:34.594     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:57:34.594     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:57:34.594     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:57:34.595     INFO function=_serve       L0094 file=server.py   ] Finished server process [2616]
[2025-08-30T21:57:34.595     INFO function=_serve       L0094 file=server.py   ] Finished server process [2616]
[2025-08-30T21:57:38.895     INFO function=_serve       L0084 file=server.py   ] Started server process [13024]
[2025-08-30T21:57:38.895     INFO function=_serve       L0084 file=server.py   ] Started server process [13024]
[2025-08-30T21:57:38.896     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:57:38.896     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:57:38.897     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:57:38.897     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:57:38.950     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:57:44.464     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:57:45.220     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A57%3A44&stodate=2025-08-30+21%3A57%3A44 "HTTP/1.1 200 OK"
[2025-08-30T21:57:45.231     INFO function=summary_emai L0127 file=daily.py    ] Chargement du corps de 7 message(s)...
[2025-08-30T21:57:45.231    ERROR function=summary_emai L0133 file=daily.py    ] chec de get_mail: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:57:45.232     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62377 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:57:45.232     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62377 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:57:45.232    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 136, in summary_emails
    resp.data for resp in detailed_responses
                          ^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'detailed_responses' where it is not associated with a value
[2025-08-30T21:57:45.232    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 136, in summary_emails
    resp.data for resp in detailed_responses
                          ^^^^^^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'detailed_responses' where it is not associated with a value
[2025-08-30T21:58:43.354     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:58:43.356  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:58:43.356  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:58:43.393     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:58:43.393     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:58:43.508     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:58:43.508     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:58:43.509     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:58:43.509     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:58:43.509     INFO function=_serve       L0094 file=server.py   ] Finished server process [13024]
[2025-08-30T21:58:43.509     INFO function=_serve       L0094 file=server.py   ] Finished server process [13024]
[2025-08-30T21:58:47.876     INFO function=_serve       L0084 file=server.py   ] Started server process [2928]
[2025-08-30T21:58:47.876     INFO function=_serve       L0084 file=server.py   ] Started server process [2928]
[2025-08-30T21:58:47.878     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:58:47.878     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:58:47.879     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:58:47.879     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:58:47.950     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:58:51.129     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:58:51.871     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A58%3A51&stodate=2025-08-30+21%3A58%3A51 "HTTP/1.1 200 OK"
[2025-08-30T21:58:51.879     INFO function=summary_emai L0127 file=daily.py    ] Chargement du corps de 7 message(s)...
[2025-08-30T21:58:51.880    ERROR function=summary_emai L0134 file=daily.py    ] chec de get_mail: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:58:51.880     INFO function=summary_emai L0141 file=daily.py    ] Corps chargs pour 0/7 messages
[2025-08-30T21:58:51.881  WARNING function=summary_emai L0144 file=daily.py    ] Aucun corps de message n'a pu tre charg.
[2025-08-30T21:58:51.881     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54353 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:58:51.881     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54353 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T21:58:51.882    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 149, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T21:58:51.882    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 149, in summary_emails
    date=datetime.now().strftime("%Y-%m-%d"),
         ^^^^^^^^^^^^
AttributeError: module 'datetime' has no attribute 'now'
[2025-08-30T21:59:05.693     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T21:59:05.694  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:59:05.694  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T21:59:05.728     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:59:05.728     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T21:59:05.839     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:59:05.839     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T21:59:05.839     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:59:05.839     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T21:59:05.840     INFO function=_serve       L0094 file=server.py   ] Finished server process [2928]
[2025-08-30T21:59:05.840     INFO function=_serve       L0094 file=server.py   ] Finished server process [2928]
[2025-08-30T21:59:10.425     INFO function=_serve       L0084 file=server.py   ] Started server process [5492]
[2025-08-30T21:59:10.425     INFO function=_serve       L0084 file=server.py   ] Started server process [5492]
[2025-08-30T21:59:10.426     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:59:10.426     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T21:59:10.427     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:59:10.427     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T21:59:10.470     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T21:59:10.681     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T21:59:11.409     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+21%3A59%3A10&stodate=2025-08-30+21%3A59%3A10 "HTTP/1.1 200 OK"
[2025-08-30T21:59:11.417     INFO function=summary_emai L0127 file=daily.py    ] Chargement du corps de 7 message(s)...
[2025-08-30T21:59:11.418    ERROR function=summary_emai L0134 file=daily.py    ] chec de get_mail: get_mail.<locals>.fetch_mail() takes 2 positional arguments but 3 were given
[2025-08-30T21:59:11.418     INFO function=summary_emai L0141 file=daily.py    ] Corps chargs pour 0/7 messages
[2025-08-30T21:59:11.419  WARNING function=summary_emai L0144 file=daily.py    ] Aucun corps de message n'a pu tre charg.
[2025-08-30T21:59:11.429     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54361 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T21:59:11.429     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54361 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:01:04.293     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:01:04.294  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:01:04.294  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:01:04.350     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:01:04.350     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:01:04.462     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:01:04.462     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:01:04.463     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:01:04.463     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:01:04.464     INFO function=_serve       L0094 file=server.py   ] Finished server process [5492]
[2025-08-30T22:01:04.464     INFO function=_serve       L0094 file=server.py   ] Finished server process [5492]
[2025-08-30T22:01:08.638     INFO function=_serve       L0084 file=server.py   ] Started server process [13964]
[2025-08-30T22:01:08.638     INFO function=_serve       L0084 file=server.py   ] Started server process [13964]
[2025-08-30T22:01:08.639     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:01:08.639     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:01:08.640     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:01:08.640     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:01:08.730     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:01:11.747     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:01:12.514     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A01%3A11&stodate=2025-08-30+22%3A01%3A11 "HTTP/1.1 200 OK"
[2025-08-30T22:01:21.480     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:01:26.981     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:01:26.983    ERROR function=correct_json L0171 file=mail.py     ] Erreur de parsing JSON dans correct_json : Expecting ',' delimiter: line 3 column 7 (char 160)
[2025-08-30T22:01:26.983     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49240 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:01:26.983     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49240 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:11:15.485     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:11:15.486  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:11:15.486  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:11:15.573     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:11:15.573     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:11:15.687     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:11:15.687     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:11:15.689     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:11:15.689     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:11:15.689     INFO function=_serve       L0094 file=server.py   ] Finished server process [13964]
[2025-08-30T22:11:15.689     INFO function=_serve       L0094 file=server.py   ] Finished server process [13964]
[2025-08-30T22:11:20.578     INFO function=_serve       L0084 file=server.py   ] Started server process [7492]
[2025-08-30T22:11:20.578     INFO function=_serve       L0084 file=server.py   ] Started server process [7492]
[2025-08-30T22:11:20.579     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:11:20.579     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:11:20.579     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:11:20.579     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:11:20.649     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:11:24.647     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:11:25.392     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A11%3A24&stodate=2025-08-30+22%3A11%3A24 "HTTP/1.1 200 OK"
[2025-08-30T22:11:25.400     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64123 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:11:25.400     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64123 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:11:25.402    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 124, in summary_emails
    date = response_mail.date.strftime("%A %d. %B %Y")
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'date'
[2025-08-30T22:11:25.402    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 124, in summary_emails
    date = response_mail.date.strftime("%A %d. %B %Y")
           ^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'date'
[2025-08-30T22:12:46.538     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:12:46.539  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:12:46.539  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:12:46.565     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:12:46.565     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:12:46.675     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:12:46.675     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:12:46.676     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:12:46.676     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:12:46.676     INFO function=_serve       L0094 file=server.py   ] Finished server process [7492]
[2025-08-30T22:12:46.676     INFO function=_serve       L0094 file=server.py   ] Finished server process [7492]
[2025-08-30T22:12:51.120     INFO function=_serve       L0084 file=server.py   ] Started server process [14660]
[2025-08-30T22:12:51.120     INFO function=_serve       L0084 file=server.py   ] Started server process [14660]
[2025-08-30T22:12:51.121     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:12:51.121     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:12:51.122     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:12:51.122     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:12:51.165     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:12:53.574     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:12:54.335     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A12%3A53&stodate=2025-08-30+22%3A12%3A53 "HTTP/1.1 200 OK"
[2025-08-30T22:13:12.607     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:13:12.626     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59995 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:13:12.626     INFO function=send         L0476 file=httptools_im] 127.0.0.1:59995 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:13:12.627    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 146, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: From: jessica.martin@techflow.com
To: me
Date: 2024-04-26 09:15
Subject: Follow-up on Q2 Planning Meeting
Hi,
Just a quick reminder that the Q2 Planning Meeting notes are due by end of day today. Please send your inputs to the shared drive.
Best,
Jessica [type=value_error, input_value=['From: jessica.martin@te...eting.\nThanks,\nDavid'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T22:13:12.627    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 146, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: From: jessica.martin@techflow.com
To: me
Date: 2024-04-26 09:15
Subject: Follow-up on Q2 Planning Meeting
Hi,
Just a quick reminder that the Q2 Planning Meeting notes are due by end of day today. Please send your inputs to the shared drive.
Best,
Jessica [type=value_error, input_value=['From: jessica.martin@te...eting.\nThanks,\nDavid'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T22:21:38.430     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:21:38.431  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:21:38.431  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:21:38.485     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:21:38.485     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:21:38.598     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:21:38.598     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:21:38.599     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:21:38.599     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:21:38.600     INFO function=_serve       L0094 file=server.py   ] Finished server process [14660]
[2025-08-30T22:21:38.600     INFO function=_serve       L0094 file=server.py   ] Finished server process [14660]
[2025-08-30T22:21:43.287     INFO function=_serve       L0084 file=server.py   ] Started server process [13564]
[2025-08-30T22:21:43.287     INFO function=_serve       L0084 file=server.py   ] Started server process [13564]
[2025-08-30T22:21:43.288     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:21:43.288     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:21:43.289     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:21:43.289     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:21:43.344     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:21:46.460     INFO function=summary_emai L0127 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:21:47.244     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A21%3A46&stodate=2025-08-30+22%3A21%3A46 "HTTP/1.1 200 OK"
[2025-08-30T22:21:49.294     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:21:49.825     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:21:49.832    ERROR function=correct_json L0176 file=mail.py     ] Erreur de validation Pydantic dans correct_json : 1 validation error for DailyResponse
emails.0
  Input should be a valid string [type=string_type, input_value={'subject': 'None', 'body': ' '}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
[2025-08-30T22:21:49.832     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61595 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:21:49.832     INFO function=send         L0476 file=httptools_im] 127.0.0.1:61595 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:22:43.255     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:22:43.256  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:22:43.256  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:22:43.333     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:22:43.333     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:22:43.435     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:22:43.435     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:22:43.436     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:22:43.436     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:22:43.436     INFO function=_serve       L0094 file=server.py   ] Finished server process [13564]
[2025-08-30T22:22:43.436     INFO function=_serve       L0094 file=server.py   ] Finished server process [13564]
[2025-08-30T22:22:47.823     INFO function=_serve       L0084 file=server.py   ] Started server process [13984]
[2025-08-30T22:22:47.823     INFO function=_serve       L0084 file=server.py   ] Started server process [13984]
[2025-08-30T22:22:47.824     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:22:47.824     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:22:47.825     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:22:47.825     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:22:47.875     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:22:50.218     INFO function=summary_emai L0127 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:22:50.988     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A22%3A50&stodate=2025-08-30+22%3A22%3A50 "HTTP/1.1 200 OK"
[2025-08-30T22:22:53.783     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:22:53.801     INFO function=summary_emai L0184 file=daily.py    ] The following e-mails have been hallucinated and removed: ['bob.martin@exemple.com', 'charlie.bernard@exemple.com', 'alice.dupont@exemple.com', 'diane.petit@exemple.com', 'eric.dubois@exemple.com']
[2025-08-30T22:22:54.397     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:22:54.400    ERROR function=correct_json L0171 file=mail.py     ] Erreur de parsing JSON dans correct_json : Expecting property name enclosed in double quotes: line 2 column 1 (char 2)
[2025-08-30T22:22:54.401     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62544 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:22:54.401     INFO function=send         L0476 file=httptools_im] 127.0.0.1:62544 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:24:44.922     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:24:44.924  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T22:24:44.924  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T22:24:44.971     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:24:44.971     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:24:45.086     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:24:45.086     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:24:45.087     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:24:45.087     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:24:45.088     INFO function=_serve       L0094 file=server.py   ] Finished server process [13984]
[2025-08-30T22:24:45.088     INFO function=_serve       L0094 file=server.py   ] Finished server process [13984]
[2025-08-30T22:24:46.542     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:24:48.376     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:24:48.377  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T22:24:48.377  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-30T22:24:49.786     INFO function=_serve       L0084 file=server.py   ] Started server process [7896]
[2025-08-30T22:24:49.786     INFO function=_serve       L0084 file=server.py   ] Started server process [7896]
[2025-08-30T22:24:49.788     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:24:49.788     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:24:49.789     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:24:49.789     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:24:49.990    ERROR function=send         L0134 file=on.py       ] Traceback (most recent call last):
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 701, in lifespan
    await receive()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\lifespan\on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\queues.py", line 186, in get
    await getter
asyncio.exceptions.CancelledError

[2025-08-30T22:24:49.990    ERROR function=send         L0134 file=on.py       ] Traceback (most recent call last):
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 701, in lifespan
    await receive()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\lifespan\on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\AppData\Roaming\uv\python\cpython-3.13.7-windows-x86_64-none\Lib\asyncio\queues.py", line 186, in get
    await getter
asyncio.exceptions.CancelledError

[2025-08-30T22:24:54.046     INFO function=_serve       L0084 file=server.py   ] Started server process [13848]
[2025-08-30T22:24:54.046     INFO function=_serve       L0084 file=server.py   ] Started server process [13848]
[2025-08-30T22:24:54.047     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:24:54.047     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:24:54.048     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:24:54.048     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:25:23.801     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:25:23.802  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:25:23.802  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:25:23.840     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:25:23.840     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:25:23.942     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:25:23.942     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:25:23.943     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:25:23.943     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:25:23.944     INFO function=_serve       L0094 file=server.py   ] Finished server process [13848]
[2025-08-30T22:25:23.944     INFO function=_serve       L0094 file=server.py   ] Finished server process [13848]
[2025-08-30T22:25:28.071     INFO function=_serve       L0084 file=server.py   ] Started server process [8128]
[2025-08-30T22:25:28.071     INFO function=_serve       L0084 file=server.py   ] Started server process [8128]
[2025-08-30T22:25:28.072     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:25:28.072     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:25:28.073     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:25:28.073     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:25:28.126     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:25:34.595     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:25:35.314     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A25%3A34&stodate=2025-08-30+22%3A25%3A34 "HTTP/1.1 200 OK"
[2025-08-30T22:25:40.152     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:25:44.000     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:25:44.002    ERROR function=correct_json L0171 file=mail.py     ] Erreur de parsing JSON dans correct_json : Expecting ':' delimiter: line 3 column 11 (char 54)
[2025-08-30T22:25:44.003     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49724 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:25:44.003     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49724 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:26:31.796     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:26:31.797  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:26:31.797  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:26:31.904     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:26:31.904     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:26:32.021     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:26:32.021     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:26:32.022     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:26:32.022     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:26:32.022     INFO function=_serve       L0094 file=server.py   ] Finished server process [8128]
[2025-08-30T22:26:32.022     INFO function=_serve       L0094 file=server.py   ] Finished server process [8128]
[2025-08-30T22:26:36.314     INFO function=_serve       L0084 file=server.py   ] Started server process [9512]
[2025-08-30T22:26:36.314     INFO function=_serve       L0084 file=server.py   ] Started server process [9512]
[2025-08-30T22:26:36.315     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:26:36.315     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:26:36.316     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:26:36.316     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:26:36.395     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:26:48.492     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:26:48.492  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:26:48.492  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:26:48.555     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:26:48.555     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:26:48.658     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:26:48.658     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:26:48.659     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:26:48.659     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:26:48.659     INFO function=_serve       L0094 file=server.py   ] Finished server process [9512]
[2025-08-30T22:26:48.659     INFO function=_serve       L0094 file=server.py   ] Finished server process [9512]
[2025-08-30T22:26:53.195     INFO function=_serve       L0084 file=server.py   ] Started server process [14908]
[2025-08-30T22:26:53.195     INFO function=_serve       L0084 file=server.py   ] Started server process [14908]
[2025-08-30T22:26:53.196     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:26:53.196     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:26:53.197     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:26:53.197     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:26:53.285     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:27:42.902     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:27:42.903  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:27:42.903  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:27:42.945     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:27:42.945     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:27:43.056     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:27:43.056     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:27:43.056     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:27:43.056     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:27:43.057     INFO function=_serve       L0094 file=server.py   ] Finished server process [14908]
[2025-08-30T22:27:43.057     INFO function=_serve       L0094 file=server.py   ] Finished server process [14908]
[2025-08-30T22:27:47.344     INFO function=_serve       L0084 file=server.py   ] Started server process [3928]
[2025-08-30T22:27:47.344     INFO function=_serve       L0084 file=server.py   ] Started server process [3928]
[2025-08-30T22:27:47.345     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:27:47.345     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:27:47.346     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:27:47.346     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:27:47.410     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:27:49.147     INFO function=summary_emai L0127 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:27:49.934     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A27%3A49&stodate=2025-08-30+22%3A27%3A49 "HTTP/1.1 200 OK"
[2025-08-30T22:28:07.798     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:28:07.816     INFO function=send         L0476 file=httptools_im] 127.0.0.1:58329 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:28:07.816     INFO function=send         L0476 file=httptools_im] 127.0.0.1:58329 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T22:28:07.817    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 164, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: From: loic.gosselke@hackaton.ch
To: loic.gosselke@hackaton.ch
Date: Saturday 30. August 2025
Subject: meq
Salut, j'aimerai bien prendre un rendez-vous. merci [type=value_error, input_value=["From: loic.gosselke@hac... Mettez  jour vos pa'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T22:28:07.817    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 164, in summary_emails
    result = event_chain.invoke(
            {"emails": ", ".join(emails), "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3082, in invoke
    input_ = context.run(step.invoke, input_, config)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\language_models\chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1183, in _generate
    raise e
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_openai\chat_models\base.py", line 1155, in _generate
    response = raw_response.parse()
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_legacy_response.py", line 139, in parse
    parsed = self._options.post_parser(parsed)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 177, in parser
    return _parse_chat_completion(
        response_format=response_format,
        chat_completion=raw_completion,
        input_tools=chat_completion_tools,
    )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 146, in parse_chat_completion
    "parsed": maybe_parse_content(
              ~~~~~~~~~~~~~~~~~~~^
        response_format=response_format,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        message=message,
        ^^^^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 199, in maybe_parse_content
    return _parse_content(response_format, message.content)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\lib\_parsing\_completions.py", line 262, in _parse_content
    return cast(ResponseFormatT, model_parse_json(response_format, content))
                                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\openai\_compat.py", line 169, in model_parse_json
    return model.model_validate_json(data)
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\pydantic\main.py", line 746, in model_validate_json
    return cls.__pydantic_validator__.validate_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        json_data, strict=strict, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 1 validation error for DailyResponse
emails
  Value error, Invalid email format: From: loic.gosselke@hackaton.ch
To: loic.gosselke@hackaton.ch
Date: Saturday 30. August 2025
Subject: meq
Salut, j'aimerai bien prendre un rendez-vous. merci [type=value_error, input_value=["From: loic.gosselke@hac... Mettez  jour vos pa'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
[2025-08-30T22:30:29.337     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:30:29.338  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:30:29.338  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:30:29.426     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:30:29.426     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:30:29.537     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:30:29.537     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:30:29.538     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:30:29.538     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:30:29.538     INFO function=_serve       L0094 file=server.py   ] Finished server process [3928]
[2025-08-30T22:30:29.538     INFO function=_serve       L0094 file=server.py   ] Finished server process [3928]
[2025-08-30T22:30:33.890     INFO function=_serve       L0084 file=server.py   ] Started server process [7004]
[2025-08-30T22:30:33.890     INFO function=_serve       L0084 file=server.py   ] Started server process [7004]
[2025-08-30T22:30:33.891     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:30:33.891     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:30:33.892     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:30:33.892     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:30:33.966     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:30:37.192     INFO function=summary_emai L0099 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:30:37.926     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A30%3A37&stodate=2025-08-30+22%3A30%3A37 "HTTP/1.1 200 OK"
[2025-08-30T22:30:42.835     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:30:44.729     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:30:44.732    ERROR function=correct_json L0176 file=mail.py     ] Erreur de validation Pydantic dans correct_json : 1 validation error for DailyResponse
meeting_suggestions.0
  Input should be a valid string [type=string_type, input_value={'date': '13-Sep-2025', '...izer': 'Sylvie Forster'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
[2025-08-30T22:30:44.732     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:30:44.732     INFO function=send         L0476 file=httptools_im] 127.0.0.1:49678 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:31:34.436     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:31:34.437  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:31:34.437  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:31:34.493     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:31:34.493     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:31:34.608     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:31:34.608     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:31:34.609     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:31:34.609     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:31:34.610     INFO function=_serve       L0094 file=server.py   ] Finished server process [7004]
[2025-08-30T22:31:34.610     INFO function=_serve       L0094 file=server.py   ] Finished server process [7004]
[2025-08-30T22:31:36.632     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:31:38.985     INFO function=_serve       L0084 file=server.py   ] Started server process [14476]
[2025-08-30T22:31:38.985     INFO function=_serve       L0084 file=server.py   ] Started server process [14476]
[2025-08-30T22:31:38.986     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:31:38.986     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:31:38.987     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:31:38.987     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:38:50.868     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:38:50.869  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:38:50.869  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:38:50.901     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:38:50.901     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:38:51.003     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:38:51.003     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:38:51.005     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:38:51.005     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:38:51.006     INFO function=_serve       L0094 file=server.py   ] Finished server process [14476]
[2025-08-30T22:38:51.006     INFO function=_serve       L0094 file=server.py   ] Finished server process [14476]
[2025-08-30T22:38:53.645     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:43:06.380     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:43:06.381  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:43:06.381  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:43:08.254     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:46:22.116     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:46:22.117  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:46:22.117  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:46:23.833     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:46:37.367     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:46:37.368  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:46:37.368  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'common\models\response\mail.py'. Reloading...
[2025-08-30T22:46:39.035     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:46:41.446     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T22:46:41.446     INFO function=_serve       L0084 file=server.py   ] Started server process [3896]
[2025-08-30T22:46:41.447     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:46:41.447     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:46:41.448     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:46:41.448     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:50:20.052     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:50:20.053  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:50:20.053  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:50:20.130     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:50:20.130     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:50:20.245     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:50:20.245     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:50:20.246     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:50:20.246     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:50:20.246     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T22:50:20.246     INFO function=_serve       L0094 file=server.py   ] Finished server process [3896]
[2025-08-30T22:50:24.714     INFO function=_serve       L0084 file=server.py   ] Started server process [3160]
[2025-08-30T22:50:24.714     INFO function=_serve       L0084 file=server.py   ] Started server process [3160]
[2025-08-30T22:50:24.715     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:50:24.715     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:50:24.716     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:50:24.716     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:50:24.755     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:53:17.768     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T22:53:17.768  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:53:17.768  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T22:53:17.786     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:53:17.786     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T22:53:17.899     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:53:17.899     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T22:53:17.900     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:53:17.900     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T22:53:17.900     INFO function=_serve       L0094 file=server.py   ] Finished server process [3160]
[2025-08-30T22:53:17.900     INFO function=_serve       L0094 file=server.py   ] Finished server process [3160]
[2025-08-30T22:53:22.831     INFO function=_serve       L0084 file=server.py   ] Started server process [14432]
[2025-08-30T22:53:22.831     INFO function=_serve       L0084 file=server.py   ] Started server process [14432]
[2025-08-30T22:53:22.832     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:53:22.832     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T22:53:22.833     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:53:22.833     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T22:53:22.882     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T22:55:14.820     INFO function=summary_emai L0129 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T22:55:15.738     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+22%3A55%3A14&stodate=2025-08-30+22%3A55%3A14 "HTTP/1.1 200 OK"
[2025-08-30T22:55:24.132     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:55:25.355     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T22:55:25.357     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63658 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T22:55:25.357     INFO function=send         L0476 file=httptools_im] 127.0.0.1:63658 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T23:00:09.821     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T23:00:09.822  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T23:00:09.822  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T23:00:09.908     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:00:09.908     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:00:10.022     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:00:10.022     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:00:10.023     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:00:10.023     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:00:10.024     INFO function=_serve       L0094 file=server.py   ] Finished server process [14432]
[2025-08-30T23:00:10.024     INFO function=_serve       L0094 file=server.py   ] Finished server process [14432]
[2025-08-30T23:00:14.257     INFO function=_serve       L0084 file=server.py   ] Started server process [12528]
[2025-08-30T23:00:14.257     INFO function=_serve       L0084 file=server.py   ] Started server process [12528]
[2025-08-30T23:00:14.258     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T23:00:14.258     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T23:00:14.258     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T23:00:14.258     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T23:00:14.346     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T23:00:15.322     INFO function=summary_emai L0142 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T23:00:16.306     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+23%3A00%3A15&stodate=2025-08-30+23%3A00%3A15 "HTTP/1.1 200 OK"
[2025-08-30T23:00:23.017     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T23:00:23.038     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54212 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T23:00:23.038     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54212 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 500
[2025-08-30T23:00:23.040    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 189, in summary_emails
    validation_result = validation_chain.invoke(
            {"answer": result, "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3080, in invoke
    input_ = context.run(step.invoke, input_, config, **kwargs)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 216, in invoke
    return self._call_with_config(
           ~~~~~~~~~~~~~~~~~~~~~~^
        self._format_prompt_with_error_handling,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        serialized=self._serialized,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 1953, in _call_with_config
    context.run(
    ~~~~~~~~~~~^
        call_func_with_variable_args,  # type: ignore[arg-type]
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
        **kwargs,
        ^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\config.py", line 429, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 189, in _format_prompt_with_error_handling
    inner_input_ = self._validate_input(inner_input)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 183, in _validate_input
    raise KeyError(
        create_message(message=msg, error_code=ErrorCode.INVALID_PROMPT_INPUT)
    )
KeyError: 'Input to ChatPromptTemplate is missing variables {\'\\n  "champ_incorrect"\'}.  Expected: [\'\\n  "champ_incorrect"\', \'answer\', \'text\'] Received: [\'answer\', \'text\']\nNote: if you intended {\n  "champ_incorrect"} to be part of the string and not a variable, please escape it with double curly braces like: \'{{\n  "champ_incorrect"}}\'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT '
[2025-08-30T23:00:23.040    ERROR function=run_asgi     L0414 file=httptools_im] Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\api\routers\daily.py", line 189, in summary_emails
    validation_result = validation_chain.invoke(
            {"answer": result, "text": text}
            )
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 3080, in invoke
    input_ = context.run(step.invoke, input_, config, **kwargs)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 216, in invoke
    return self._call_with_config(
           ~~~~~~~~~~~~~~~~~~~~~~^
        self._format_prompt_with_error_handling,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        serialized=self._serialized,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\base.py", line 1953, in _call_with_config
    context.run(
    ~~~~~~~~~~~^
        call_func_with_variable_args,  # type: ignore[arg-type]
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
        **kwargs,
        ^^^^^^^^^
    ),
    ^
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\runnables\config.py", line 429, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 189, in _format_prompt_with_error_handling
    inner_input_ = self._validate_input(inner_input)
  File "C:\Users\gosse\Desktop\Hackathon\Hackathon-2025\.venv\Lib\site-packages\langchain_core\prompts\base.py", line 183, in _validate_input
    raise KeyError(
        create_message(message=msg, error_code=ErrorCode.INVALID_PROMPT_INPUT)
    )
KeyError: 'Input to ChatPromptTemplate is missing variables {\'\\n  "champ_incorrect"\'}.  Expected: [\'\\n  "champ_incorrect"\', \'answer\', \'text\'] Received: [\'answer\', \'text\']\nNote: if you intended {\n  "champ_incorrect"} to be part of the string and not a variable, please escape it with double curly braces like: \'{{\n  "champ_incorrect"}}\'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT '
[2025-08-30T23:01:44.526     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-30T23:01:44.527  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T23:01:44.527  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily.py'. Reloading...
[2025-08-30T23:01:44.593     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:01:44.593     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:01:44.706     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:01:44.706     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:01:44.707     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:01:44.707     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:01:44.707     INFO function=_serve       L0094 file=server.py   ] Finished server process [12528]
[2025-08-30T23:01:44.707     INFO function=_serve       L0094 file=server.py   ] Finished server process [12528]
[2025-08-30T23:01:49.170     INFO function=_serve       L0084 file=server.py   ] Started server process [6884]
[2025-08-30T23:01:49.170     INFO function=_serve       L0084 file=server.py   ] Started server process [6884]
[2025-08-30T23:01:49.170     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T23:01:49.170     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-30T23:01:49.171     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T23:01:49.171     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-30T23:01:49.255     INFO function=_log_changes L0308 file=main.py     ] 5 changes detected
[2025-08-30T23:01:49.269     INFO function=summary_emai L0128 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-30T23:01:49.990     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-29+23%3A01%3A49&stodate=2025-08-30+23%3A01%3A49 "HTTP/1.1 200 OK"
[2025-08-30T23:01:55.147     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T23:01:56.319     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-30T23:01:56.321     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54224 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T23:01:56.321     INFO function=send         L0476 file=httptools_im] 127.0.0.1:54224 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-30T23:02:27.262     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:02:27.262     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-30T23:02:27.374     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:02:27.374     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-30T23:02:27.375     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:02:27.375     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-30T23:02:27.376     INFO function=_serve       L0094 file=server.py   ] Finished server process [6884]
[2025-08-30T23:02:27.376     INFO function=_serve       L0094 file=server.py   ] Finished server process [6884]
[2025-08-31T08:43:35.525     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-31T08:43:35.525     INFO function=__init__     L0319 file=config.py   ] Will watch for changes in these directories: ['C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\api', 'C:\\Users\\gosse\\Desktop\\Hackathon\\Hackathon-2025\\common']
[2025-08-31T08:43:35.526     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-31T08:43:35.526     INFO function=bind_socket  L0525 file=config.py   ] Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
[2025-08-31T08:43:35.527     INFO function=startup      L0080 file=basereload.p] Started reloader process [8312] using WatchFiles
[2025-08-31T08:43:35.527     INFO function=startup      L0080 file=basereload.p] Started reloader process [8312] using WatchFiles
[2025-08-31T08:43:39.746     INFO function=_serve       L0084 file=server.py   ] Started server process [10328]
[2025-08-31T08:43:39.746     INFO function=_serve       L0084 file=server.py   ] Started server process [10328]
[2025-08-31T08:43:39.747     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-31T08:43:39.747     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-31T08:43:39.749     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-31T08:43:39.749     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-31T08:44:05.302     INFO function=summary_emai L0128 file=daily.py    ] Request for mailbox id: 90cd20dc-69ff-3f71-a760-1a8f26866c1b
[2025-08-31T08:44:06.009     INFO function=_send_single L1740 file=_client.py  ] HTTP Request: GET https://mail.infomaniak.com/api/mail/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message?offset=0&limit=10&thread=on&sfromdate=2025-08-30+08%3A44%3A05&stodate=2025-08-31+08%3A44%3A05 "HTTP/1.1 200 OK"
[2025-08-31T08:44:11.235     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-31T08:44:14.397     INFO function=_send_single L1025 file=_client.py  ] HTTP Request: POST https://api.infomaniak.com/2/ai/105923/openai/v1/chat/completions "HTTP/1.1 200 OK"
[2025-08-31T08:44:14.400     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64175 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-31T08:44:14.400     INFO function=send         L0476 file=httptools_im] 127.0.0.1:64175 - "POST /daily/90cd20dc-69ff-3f71-a760-1a8f26866c1b/folder/eJzz9HPyjwAABGYBgQ--/message HTTP/1.1" 200
[2025-08-31T08:47:46.507     INFO function=_log_changes L0308 file=main.py     ] 1 change detected
[2025-08-31T08:47:46.509  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-31T08:47:46.509  WARNING function=run          L0055 file=basereload.p] WatchFiles detected changes in 'api\routers\daily copy.py'. Reloading...
[2025-08-31T08:47:46.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-31T08:47:46.517     INFO function=shutdown     L0264 file=server.py   ] Shutting down
[2025-08-31T08:47:46.628     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-31T08:47:46.628     INFO function=shutdown     L0067 file=on.py       ] Waiting for application shutdown.
[2025-08-31T08:47:46.629     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-31T08:47:46.629     INFO function=shutdown     L0076 file=on.py       ] Application shutdown complete.
[2025-08-31T08:47:46.629     INFO function=_serve       L0094 file=server.py   ] Finished server process [10328]
[2025-08-31T08:47:46.629     INFO function=_serve       L0094 file=server.py   ] Finished server process [10328]
[2025-08-31T08:47:50.991     INFO function=_serve       L0084 file=server.py   ] Started server process [2996]
[2025-08-31T08:47:50.991     INFO function=_serve       L0084 file=server.py   ] Started server process [2996]
[2025-08-31T08:47:50.992     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-31T08:47:50.992     INFO function=startup      L0048 file=on.py       ] Waiting for application startup.
[2025-08-31T08:47:50.993     INFO function=startup      L0062 file=on.py       ] Application startup complete.
[2025-08-31T08:47:50.993     INFO function=startup      L0062 file=on.py       ] Application startup complete.
